#+title: Chimp: Efficient Lossless Floating Point Compression for Time Series Databases

https://www.vldb.org/pvldb/vol15/p3058-liakos.pdf

** abstract

è¿™ä¸ªç®—æ³•æ•ˆæœä¸Šï¼š
- å’Œé€šç”¨å‹ç¼©ç®—æ³•ç›¸æ¯”ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½†æ˜¯å‹ç¼©æ¯”å·®ä¸éƒ½ã€‚
- å’Œgorillaç›¸æ¯”ï¼Œå¯ä»¥åœ¨èŠ‚çœ50%çš„ç©ºé—´ã€‚

#+BEGIN_QUOTE
Our experimental evaluation demonstrates that our approach readily outperforms competing techniques, attaining compression ratios that are competitive with slower general purpose algorithms, and on average around 50% of the space required by state-of-the-art streaming approaches.
#+END_QUOTE

chimpæ˜¯è€ƒè™‘äº†çœŸå®æ•°æ®ç‰¹å¾æƒ…å†µï¼Œç„¶ååœ¨gorillaç®—æ³•ä¸Šæ”¹è¿›å¾—åˆ°çš„ã€‚

** introduction

ç›®å‰å¤§éƒ¨åˆ†æµ®ç‚¹å‹ç¼©ç®—æ³•éƒ½æ˜¯ä½¿ç”¨å’Œå…¶ä»–å€¼æ¥åšxorå¯»æ‰¾å·®å¼‚bitsæ¥åšå‹ç¼©çš„ï¼Œå¾—åˆ°çš„ç»“æœå¤§éƒ¨åˆ†0éƒ½é›†ä¸­åœ¨å‰ç¼€(leading zerosè€Œä¸æ˜¯åç¼€(trailing zeros). è¿™ä¸ªä¹Ÿæ˜¯å’Œgorillaçš„ä¸»è¦å·®åˆ«ï¼šchimpç®—æ³•æ”¹è¿›leading zerosçš„å‹ç¼©ï¼Œè€Œtrailing zeroså‹ç¼©åˆ™çœ‹æ›´å¤§çš„å€¼ç©ºé—´(chimp 128).

#+BEGIN_QUOTE
In this paper, we perform a rigorous study of compression al- gorithms suitable for floating point data to uncover the advantages and disadvantages of different approaches. We also study various real-world floating point time series and bring to light properties that provide high compression potential. Our investigation shows that when two consecutive floating point values are not identical, their respective XORed value is not likely to have a large number of trailing zeros. On the contrary, most resulting XORed values exhibit a considerable number of leading zeros. Based on our findings, we design and propose Chimp, a novel lossless streaming compres- sion algorithm that preserves the compression and decompression speed of earlier streaming approaches, while also providing signi- ficant space savings that are competitive with slower, yet extremely effective general purpose compression schemes.
#+END_QUOTE

** gorilla

ä¸‹é¢æ˜¯gorillaçš„ç®—æ³•ä»£ç ï¼Œä¸»è¦æ€æƒ³å°±æ˜¯ï¼š
- å¦‚æœmeaning bitsè½åœ¨ä¹‹å‰çš„èŒƒå›´å†…ï¼ˆ14-16ï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥å¤ç”¨ä¹‹å‰çš„èŒƒå›´ï¼Œå°±å¯ä»¥èŠ‚çœè®¸å¤šå¼€é”€ã€‚
- å¦‚æœmeaning bitsè½åœ¨ä¹‹å¤–ï¼Œä¹Ÿå°±æ˜¯è¯´leading zeros/trailing zerosæ›´å¤šï¼Œé‚£ä¹ˆå°±éœ€è¦å†™æ–°çš„èŒƒå›´ã€‚
- leading zeroså› ä¸ºç”¨5bitså»ç¼–ç ï¼Œæ‰€ä»¥æœ€å¤šè¡¨ç¤º32ä¸ªã€‚

[[../images/Pasted-Image-20231129085006.png]]

** real-world data

gorillaè®¾è®¡åˆè¡·ä¸Šè®¤ä¸ºleading/trailing zeroså¯èƒ½æ˜¯åŒæ ·å¤šçš„ï¼Œä½†æ˜¯chimpå›¢é˜Ÿå‘ç°ç°å®æ•°æ®åˆ†å¸ƒå’Œé¢„æƒ³çš„è¿˜ä¸åŒã€‚

*** trailing zeros

é¦–å…ˆæ˜¯ trailing zeros. å¤§éƒ¨åˆ†ç°å®æ•°æ®é›†åˆåªæœ‰ 0-5 bits. å…¶ä»–æ•°æ®é›†åˆ(PM10-dust, City-temp, Stocks-UK)å› ä¸ºç²¾åº¦å’Œè¡¨ç¤ºé—®é¢˜æ‰€ä»¥å¯ä»¥åˆ°å¾ˆé«˜ã€‚

[[../images/Pasted-Image-20231129085937.png]]

#+BEGIN_QUOTE
We observe that with the exception of two time series, namely PM10-dust and Air-pressure, it is rather unlikely for two consecutive values to be identical. For most of the time series examined there are limited cases of resulting XORed values with 64 trailing zeros. Moreover, we observe that with very high probability the resulting values have less than six trailing zeros. Therefore, the design choice of Gorilla to reserve six bits to denote the number of trailing zeros,7 actually increases the space requirements of simply storing the actual bits. Finally, there are only three datasets for which there is a significant number of cases of trailing zeros in the range 6 âˆ’ 63, i.e., City-temp, Stocks-UK, and PM10-dust. The first two use a single decimal digit and, as we can see in Figure 3a, there are many cases in which the XOR of different values with this precision causes a considerable number of trailing zeros in that range. PM10-dust uses 3 decimal digits, but certain fractional parts, such as the ones of Figure 3b, are much more frequent than others in this dataset. In most of the time series of Figure 2, we can clearly see that there are very few cases of resulting values with trailing zeros in the range 6 âˆ’ 63.
#+END_QUOTE

[[../images/Pasted-Image-20231129090142.png]]

*** leading zeros

leading zeros é›†ä¸­åœ¨12-24 è¿™ä¸ªèŒƒå›´å†…ï¼Œä½†æ˜¯åŸºæœ¬ä¸ä¼šè¶…è¿‡30.

[[../images/Pasted-Image-20231129093155.png]]

#+BEGIN_QUOTE
Figure 4 depicts the distribution of the number of leading zeros that result when applying bitwise XOR between two consecutive values for all the time series of our dataset. As we can see, for most time series the result usually has at least 12 leading zeros, meaning that both the sign and the exponent of the XORed values are identical. This is not the case for City-temp, PM10-dust, and Wind-dir that often exhibit smaller runs of leading zeros, in the range 8 âˆ’ 12. This means that the exponent is not identical, but quite similar, as a few of its less significant bits are different. We also notice in Figure 4 that Air-pressure is the only dataset whose successive values produce a large number of leading zeros when XORed. This is due to the large integer part the values of this dataset have, which causes similarity between consecutive values with regards to all sign, exponent, and the first bits of the significand. However, even for the Air-pressure dataset, XORed values rarely have more than 30 leading zeros.
#+END_QUOTE

** chimp

chimp ç®—æ³•æ˜¯åŸºäºgorillaæ”¹è¿›çš„ï¼Œä¸»è¦ä½“ç°çš„ï¼š
- è€ƒè™‘åˆ°trailing å’Œ leading zerosçš„ä¸å¯¹ç§°æ€§ã€‚
- è€ƒè™‘åˆ°leading zerosçš„èŒƒå›´ï¼Œæ‰€ä»¥æŒ‰ç…§ "0,8,12,16,18,20,22,24" 8ç§æƒ…å†µè¿›è¡Œç¼–ç ã€‚

[[../images/Pasted-Image-20231129093836.png]]

[[../images/Pasted-Image-20231129093910.png]]

** chimp128

åœ¨chimpåŸºç¡€ä¸Šï¼Œè€ƒè™‘ä¸æ˜¯å’Œprevious valueåšxor, è€Œæ˜¯å¯»æ‰¾çœ‹çœ‹æœ€è¿‘16/128ä¸ªvaluesé‡Œé¢æœ‰æ²¡æœ‰trailing zeroså®Œå…¨ç›¸åŒçš„ã€‚è¿™ä¸ªå®ç°ç»“æœå‘ç°å¦‚æœæ‰©å±•åˆ°128ä¸ªçš„è¯ï¼Œé‚£ä¹ˆä¼šæœ‰è®¸å¤šçš„trailing zeros. ä½†æ˜¯äºæ­¤åŒæ—¶æˆ‘ä»¬éœ€è¦è®°å½•å’Œé‚£ä¸ªä½ç½®åšxor. è¿™ä¸ªéœ€è¦å¢åŠ 7bits.(1<<7 = 128)

[[../images/Pasted-Image-20231129094113.png]]

åœ¨å®ç°ä¸Šå¯ä»¥é’ˆå¯¹trailing bitsåšbook keeping. å‡è®¾å¯¹æœ€åé¢14bitsåšè®°å½•
- æ¯æ¬¡æ’å…¥çš„æ—¶å€™è®°å½• `pos[v & (1 << 14)-1] = i`
- åŒ¹é…çš„æ—¶å€™å¯ä»¥åˆ¤æ–­ `j = pos[v & (1 << 14)-1];  if (j-i) < 128`.

#+BEGIN_QUOTE
Despite the impressive compression potential of using previous values, performing a considerable number of XOR operations to find the best match is costly. We are interested, however, in providing compression that is fast enough to cope with the ingestion rates that contemporary time series databases need to handle. To this end, Chimp128 uses a circular (ring) buffer of size 128 to hold the most recent values and an array of size 214 (2ğ‘™ğ‘œğ‘”264+ğ‘™ğ‘œğ‘”2128+1) to quickly come up with a suitable previous value. More specifically, we place every value ğ‘£ğ‘– we encounter in the ğ‘–%128 position of the ring buffer. We also place ğ‘– in the ğ‘£ğ‘– & (214 âˆ’ 1) position of the array. That is, we use the less significant bits of ğ‘£ğ‘– to come up with the position in the array. In this way, while compressing a new value ğ‘£ ğ‘— , we can retrieve in constant time the most recent value already encountered with at least 14 identical trailing bits, by looking in the ğ‘£ ğ‘— & (214 âˆ’ 1) position of the array. If this value is within the 128 previous data points, i.e., if ğ‘— âˆ’ğ‘– â‰¤ 128, we can use it to compress our new value. Even though this approach evicts some of the previous values examined, we will show in our experimental evaluation that our respective compression ratio loss is negligible. On the contrary, the compression time speed-up gains are significant. Moreover, the respective 33ğ¾ğµ of memory requirements are very modest.
#+END_QUOTE

ä¿®æ”¹å¾—åˆ°çš„chimp128ç®—æ³•å°±æ˜¯ä¸‹é¢è¿™æ ·çš„

[[../images/Pasted-Image-20231129094639.png]]
