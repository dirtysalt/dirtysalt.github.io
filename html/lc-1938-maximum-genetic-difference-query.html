<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LC 1938. 查询最大基因差</title>
<meta name="author" content="dirtysalt" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/themes/favicon.ico" /><link rel="stylesheet" type="text/css" href="/themes/simple.css"/></head>
<body>
<div id="content" class="content">
<h1 class="title">LC 1938. 查询最大基因差</h1>
<p>
<a href="https://leetcode-cn.com/problems/maximum-genetic-difference-query/">https://leetcode-cn.com/problems/maximum-genetic-difference-query/</a>
</p>

<p>
思路不是很复杂：
</p>
<ol class="org-ol">
<li>存储在每个节点上的查询值</li>
<li>DFS遍历整棵树，每次经过一个节点，就将该节点放入trie里面</li>
<li>根据trie找到这个节点上所有需要查询的值的最大xor.</li>
<li>DFS退出这个节点的时候，从trie里面删除这个节点</li>
</ol>

<p>
想过应该来怎么实现删除操作，发现题解里面给的计数方案好像是最简单的，很容易就把程序写正确。
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">class</span> <span class="org-py-class-name">Tree</span>:
    <span class="org-py-def-class">def</span> <span class="org-function-name">__init__</span>(<span class="org-py-object-reference">self</span>):
        <span class="org-py-object-reference">self</span>.child = [<span class="org-py-pseudo-keyword">None</span>, <span class="org-py-pseudo-keyword">None</span>]
        <span class="org-py-object-reference">self</span>.cnt = <span class="org-py-number">0</span>


<span class="org-py-def-class">def</span> <span class="org-function-name">insert</span>(root, x, bits):
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">reversed</span>(range(bits)):
        <span class="org-py-variable-name">side</span> = (x &gt;&gt; i) &amp; 0x1
        <span class="org-keyword">if</span> root.child[side] <span class="org-keyword">is</span> <span class="org-py-pseudo-keyword">None</span>:
            <span class="org-py-variable-name">t</span> = Tree()
            <span class="org-py-variable-name">root.child</span>[side] = t
        <span class="org-py-variable-name">root</span> = root.child[side]
        <span class="org-py-variable-name">root.cnt</span> += <span class="org-py-number">1</span>


<span class="org-py-def-class">def</span> <span class="org-function-name">query</span>(root, x, bits):
    <span class="org-py-variable-name">ans</span> = <span class="org-py-number">0</span>
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">reversed</span>(range(bits)):
        <span class="org-py-variable-name">side</span> = (x &gt;&gt; i) &amp; 0x1
        <span class="org-py-variable-name">ans</span> = ans * <span class="org-py-number">2</span>
        <span class="org-keyword">if</span> root.child[<span class="org-py-number">1</span> - side] <span class="org-keyword">is</span> <span class="org-keyword">not</span> <span class="org-py-pseudo-keyword">None</span> <span class="org-keyword">and</span> root.child[<span class="org-py-number">1</span> - side].cnt != <span class="org-py-number">0</span>:
            <span class="org-py-variable-name">ans</span> += <span class="org-py-number">1</span>
            <span class="org-py-variable-name">root</span> = root.child[<span class="org-py-number">1</span> - side]
        <span class="org-keyword">else</span>:
            <span class="org-py-variable-name">root</span> = root.child[side]
    <span class="org-keyword">return</span> ans


<span class="org-py-def-class">def</span> <span class="org-function-name">remove</span>(root, x, bits):
    <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">reversed</span>(range(bits)):
        <span class="org-py-variable-name">side</span> = (x &gt;&gt; i) &amp; 0x1
        <span class="org-py-variable-name">root</span> = root.child[side]
        <span class="org-py-variable-name">root.cnt</span> -= <span class="org-py-number">1</span>


<span class="org-py-def-class">class</span> <span class="org-py-class-name">Solution</span>:
    <span class="org-py-def-class">def</span> <span class="org-function-name">maxGeneticDifference</span>(<span class="org-py-object-reference">self</span>, parents: List[<span class="org-py-builtins">int</span>], queries: List[List[<span class="org-py-builtins">int</span>]]) -&gt; List[<span class="org-py-builtins">int</span>]:
        <span class="org-py-variable-name">n</span> = <span class="org-py-builtins">len</span>(parents)
        <span class="org-py-variable-name">child</span> = [[] <span class="org-keyword">for</span> <span class="org-py-builtins">_</span> <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n)]
        <span class="org-py-variable-name">root</span> = <span class="org-py-pseudo-keyword">None</span>
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n):
            <span class="org-py-variable-name">p</span> = parents[i]
            child[p].append(i)
            <span class="org-keyword">if</span> <span class="org-py-variable-name">p</span> == -<span class="org-py-number">1</span>:
                <span class="org-py-variable-name">root</span> = i

        <span class="org-py-variable-name">maxValue</span> = n
        <span class="org-py-variable-name">flatQueries</span> = [[] <span class="org-keyword">for</span> <span class="org-py-builtins">_</span> <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n)]
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(len(queries)):
            <span class="org-py-variable-name">node</span>, <span class="org-py-variable-name">v</span> = queries[i]
            flatQueries[node].append((i, v))
            <span class="org-py-variable-name">maxValue</span> = <span class="org-py-builtins">max</span>(maxValue, v)

        <span class="org-py-variable-name">bits</span> = <span class="org-py-number">1</span>
        <span class="org-keyword">while</span> (<span class="org-py-number">1</span> &lt;&lt; bits) &lt;= maxValue:
            <span class="org-py-variable-name">bits</span> += <span class="org-py-number">1</span>

        <span class="org-py-variable-name">vis</span> = [<span class="org-py-number">0</span>] * n
        <span class="org-py-variable-name">tree</span> = Tree()
        <span class="org-py-variable-name">ans</span> = [<span class="org-py-number">0</span>] * <span class="org-py-builtins">len</span>(queries)

        <span class="org-py-def-class">def</span> <span class="org-function-name">dfs</span>(x):
            <span class="org-py-variable-name">vis</span>[x] = <span class="org-py-number">1</span>

            insert(tree, x, bits)
            <span class="org-keyword">for</span> idx, v <span class="org-keyword">in</span> flatQueries[x]:
                <span class="org-py-variable-name">res</span> = query(tree, v, bits)
                <span class="org-py-variable-name">ans</span>[idx] = res

            <span class="org-keyword">for</span> y <span class="org-keyword">in</span> child[x]:
                <span class="org-keyword">if</span> vis[y]: <span class="org-keyword">continue</span>
                dfs(y)

            remove(tree, x, bits)

        dfs(root)
        <span class="org-keyword">return</span> ans
</pre>
</div>
</div>
<div id="content"><!-- DISQUS BEGIN --><div id="disqus_thread"></div><script>/***  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/var disqus_config = function () {this.page.url = 'https://dirtysalt.github.io/html/lc-1938-maximum-genetic-difference-query.html';this.page.identifier = 'lc-1938-maximum-genetic-difference-query.html';};(function() {var d = document, s = d.createElement('script');s.src = 'https://dirlt.disqus.com/embed.js';s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><!-- DISQUS END --></div></body>
</html>
