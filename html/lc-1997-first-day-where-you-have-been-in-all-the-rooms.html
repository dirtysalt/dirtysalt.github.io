<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LC 1997. 访问完所有房间的第一天</title>
<meta name="author" content="dirtysalt" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/themes/favicon.ico" /><link rel="stylesheet" type="text/css" href="/themes/simple.css"/></head>
<body>
<div id="content" class="content">
<h1 class="title">LC 1997. 访问完所有房间的第一天</h1>
<p>
<a href="https://leetcode-cn.com/contest/weekly-contest-257/problems/first-day-where-you-have-been-in-all-the-rooms/">https://leetcode-cn.com/contest/weekly-contest-257/problems/first-day-where-you-have-been-in-all-the-rooms/</a>
</p>

<p>
初看这题目觉得似乎有什么公式可以推导出来，但是后来觉得这个公式太复杂以至于没有办法推导出来，因为往回跳的位置其实是不确定的。
</p>

<p>
这题有好几个关键点：
</p>
<ol class="org-ol">
<li>如果某个房间是奇数次访问，那么之前的房间肯定都是偶数次访问过。</li>
<li>如果某个房间p是奇数次访问，那么
<ul class="org-ul">
<li>我们需要立刻调回到 next[p] 上</li>
<li>然后继续回调若干次，重新回到next[p]上</li>
<li>然后前进到next[p]+1上, 此时next[p]+1肯定是奇数</li>
<li>接着就和处理next[p]一样</li>
</ul></li>
<li>所以这里的关键是，如果我们回调到某个位置x（那么此时x一定是奇数次访问），那么重新回到x需要多久，这个可以通过动态规划得到，假设是 `cyc[x]`</li>
<li>那么如果访问房间p是奇数次，那么
<ul class="org-ul">
<li>我们回调到 x=next[p] 上，然后重新回到 next[p]，就有 cyc[x]+1次跳跃</li>
<li>前进到x+1, 然后重新回到 x+1, 就有 cyc[x+1]+1次跳跃</li>
<li>直到p-1节点上，最后还有一次跳跃</li>
<li>这个过程可以通过前缀和来求解</li>
</ul></li>
</ol>

<p>
理清楚了过程代码写起来就比较简单，而且好像也没有什么边界情况。
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-py-def-class">class</span> <span class="org-py-class-name">Solution</span>:
    <span class="org-py-def-class">def</span> <span class="org-function-name">firstDayBeenInAllRooms</span>(<span class="org-py-object-reference">self</span>, nextVisit: List[<span class="org-py-builtins">int</span>]) -&gt; <span class="org-py-builtins">int</span>:
        <span class="org-py-variable-name">n</span> = <span class="org-py-builtins">len</span>(nextVisit)
        <span class="org-py-variable-name">acc</span> = [<span class="org-py-number">0</span>] * (n + <span class="org-py-number">1</span>)
        <span class="org-py-variable-name">cyc</span> = [<span class="org-py-number">0</span>] * n

        <span class="org-py-variable-name">MOD</span> = <span class="org-py-number">10</span> ** <span class="org-py-number">9</span> + <span class="org-py-number">7</span>

        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n):
            <span class="org-py-variable-name">back</span> = nextVisit[i]
            <span class="org-keyword">if</span> <span class="org-py-variable-name">back</span> == i:
                <span class="org-py-variable-name">cyc</span>[i] = <span class="org-py-number">1</span>
            <span class="org-keyword">else</span>:
                <span class="org-py-variable-name">cyc</span>[i] = (acc[i] - acc[back]) + (i - back + <span class="org-py-number">1</span>)
                <span class="org-py-variable-name">cyc</span>[i] %= MOD
            <span class="org-py-variable-name">acc</span>[i + <span class="org-py-number">1</span>] = acc[i] + cyc[i]
            <span class="org-py-variable-name">acc</span>[i + <span class="org-py-number">1</span>] %= MOD

        <span class="org-comment"># print(cyc)</span>

        <span class="org-py-variable-name">ans</span> = <span class="org-py-number">0</span>
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n - <span class="org-py-number">1</span>):
            <span class="org-comment"># how many steps from i to i+1</span>
            <span class="org-py-variable-name">ans</span> += cyc[i] + <span class="org-py-number">1</span>
            <span class="org-py-variable-name">ans</span> %= MOD

        <span class="org-keyword">return</span> ans
</pre>
</div>
</div>
<div id="content"><!-- DISQUS BEGIN --><div id="disqus_thread"></div><script>/***  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/var disqus_config = function () {this.page.url = 'https://dirtysalt.github.io/html/lc-1997-first-day-where-you-have-been-in-all-the-rooms.html';this.page.identifier = 'lc-1997-first-day-where-you-have-been-in-all-the-rooms.html';};(function() {var d = document, s = d.createElement('script');s.src = 'https://dirlt.disqus.com/embed.js';s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><!-- DISQUS END --></div></body>
</html>
