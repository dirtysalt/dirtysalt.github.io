<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LC 1916. 统计为蚁群构筑房间的不同顺序</title>
<meta name="author" content="dirtysalt" />
<meta name="generator" content="Org Mode" />
<link rel="shortcut icon" href="/themes/favicon.ico" /><link rel="stylesheet" type="text/css" href="/themes/simple.css"/></head>
<body>
<div id="content" class="content">
<h1 class="title">LC 1916. 统计为蚁群构筑房间的不同顺序</h1>
<p>
<a href="https://leetcode-cn.com/contest/weekly-contest-247/problems/count-ways-to-build-rooms-in-an-ant-colony/">https://leetcode-cn.com/contest/weekly-contest-247/problems/count-ways-to-build-rooms-in-an-ant-colony/</a>
</p>

<p>
因为只有N个节点，并且只有N-1条边，同时保证最后是完全联通的，所以结构上只能是一个树。
</p>

<p>
假设一个节点有3个孩子ABC，每个孩子分别有Na, Nb, Nc种访问顺序，那么这棵树有：
</p>
<ol class="org-ol">
<li>首先不考虑A, B, C各自节点穿插，那么就有Na * Nb * Nc种访问顺序</li>
<li>如果考虑之间的穿插，不考虑ABC内部顺序的话，那么有(A+B+C)!种访问顺序</li>
<li>如果考虑内部顺序的话，那么还要除去 (A! * B! * C!), 因为对A内来说顺序不能打乱，已经有Na种了。</li>
</ol>

<p>
这个计算过程涉及到除法取模，所以要用到 <a href="euler-and-fermat-little-theorem.html">费马小定理</a>. 阶乘以及阶乘的倒数必须预先计算出来。整个过程分为两步：构建树和遍历树。
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter">#</span><span class="org-comment">!/usr/bin/env python</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">coding:utf-8</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Copyright (C) dirlt</span>

<span class="org-py-import-from">from</span> typing <span class="org-py-import-from">import</span> List
<span class="org-py-import-from">from</span> collections <span class="org-py-import-from">import</span> Counter, defaultdict, deque
<span class="org-py-import-from">from</span> functools <span class="org-py-import-from">import</span> lru_cache
<span class="org-py-import-from">import</span> heapq


<span class="org-py-def-class">class</span> <span class="org-py-class-name">Tree</span>:
    <span class="org-py-def-class">def</span> <span class="org-function-name">__init__</span>(<span class="org-py-object-reference">self</span>, idx):
        <span class="org-py-object-reference">self</span>.idx = idx
        <span class="org-py-object-reference">self</span>.child = []
        <span class="org-py-object-reference">self</span>.n = <span class="org-py-number">1</span>
        <span class="org-py-object-reference">self</span>.val = <span class="org-py-number">1</span>


<span class="org-py-def-class">class</span> <span class="org-py-class-name">Solution</span>:
    <span class="org-py-def-class">def</span> <span class="org-function-name">waysToBuildRooms</span>(<span class="org-py-object-reference">self</span>, prevRoom: List[<span class="org-py-builtins">int</span>]) -&gt; <span class="org-py-builtins">int</span>:
        <span class="org-comment"># n&#20010;&#33410;&#28857;&#24182;&#19988;n-1&#26465;&#36793;&#65292;&#24182;&#19988;0&#21487;&#20197;&#35775;&#38382;&#21040;&#25152;&#26377;&#25151;&#38388;&#65292;&#35828;&#26126;&#26159;&#20010;&#26641;&#32467;&#26500;</span>
        <span class="org-py-variable-name">n</span> = <span class="org-py-builtins">len</span>(prevRoom)
        <span class="org-py-variable-name">ind</span> = [<span class="org-py-number">0</span>] * n
        <span class="org-keyword">for</span> x <span class="org-keyword">in</span> prevRoom:
            <span class="org-keyword">if</span> <span class="org-py-variable-name">x</span> == -<span class="org-py-number">1</span>: <span class="org-keyword">continue</span>
            <span class="org-py-variable-name">ind</span>[x] += <span class="org-py-number">1</span>

        <span class="org-comment"># build tree by top sort.</span>
        <span class="org-py-import-from">from</span> collections <span class="org-py-import-from">import</span> deque
        <span class="org-py-variable-name">dq</span> = deque()
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n):
            <span class="org-keyword">if</span> <span class="org-py-variable-name">ind</span>[i] == <span class="org-py-number">0</span>:
                dq.append(i)
        <span class="org-py-variable-name">trees</span> = []
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(n):
            trees.append(Tree(i))

        <span class="org-keyword">while</span> dq:
            <span class="org-py-variable-name">x</span> = dq.popleft()
            <span class="org-py-variable-name">p</span> = prevRoom[x]
            <span class="org-keyword">if</span> <span class="org-py-variable-name">p</span> == -<span class="org-py-number">1</span>: <span class="org-keyword">continue</span>
            <span class="org-py-variable-name">t</span> = trees[x]
            <span class="org-py-variable-name">pt</span> = trees[p]
            pt.child.append(t)
            <span class="org-py-variable-name">ind</span>[p] -= <span class="org-py-number">1</span>
            <span class="org-keyword">if</span> <span class="org-py-variable-name">ind</span>[p] == <span class="org-py-number">0</span>:
                dq.append(p)

        <span class="org-py-variable-name">MOD</span> = <span class="org-py-number">10</span> ** <span class="org-py-number">9</span> + <span class="org-py-number">7</span>
        <span class="org-py-variable-name">fac</span> = [<span class="org-py-number">0</span>] * (n + <span class="org-py-number">1</span>)
        <span class="org-py-variable-name">rev</span> = [<span class="org-py-number">0</span>] * (n + <span class="org-py-number">1</span>)

        <span class="org-py-variable-name">t</span> = <span class="org-py-number">1</span>
        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(<span class="org-py-number">1</span>, n + <span class="org-py-number">1</span>):
            <span class="org-py-variable-name">t</span> = (t * i) % MOD
            <span class="org-py-variable-name">fac</span>[i] = t

        <span class="org-py-def-class">def</span> <span class="org-function-name">pow</span>(x, y):
            <span class="org-py-variable-name">t</span> = <span class="org-py-number">1</span>
            <span class="org-keyword">while</span> y:
                <span class="org-keyword">if</span> y &amp; 0x1:
                    <span class="org-py-variable-name">t</span> = (t * x) % MOD
                <span class="org-py-variable-name">x</span> = (x * x) % MOD
                <span class="org-py-variable-name">y</span> = y &gt;&gt; <span class="org-py-number">1</span>
            <span class="org-keyword">return</span> t

        <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-py-builtins">range</span>(<span class="org-py-number">1</span>, n + <span class="org-py-number">1</span>):
            <span class="org-py-variable-name">rev</span>[i] = <span class="org-py-builtins">pow</span>(fac[i], MOD - <span class="org-py-number">2</span>)

        <span class="org-comment"># print(fac, rev)</span>

        <span class="org-py-def-class">def</span> <span class="org-function-name">compute</span>(t):
            <span class="org-keyword">if</span> <span class="org-py-builtins">len</span>(t.child) == <span class="org-py-number">0</span>:
                <span class="org-keyword">return</span>

            <span class="org-comment"># &#20551;&#35774;&#26377;3&#20010;&#23376;&#33410;&#28857;&#65292;A, B, C</span>
            <span class="org-comment"># &#27599;&#20010;&#33410;&#28857;&#19979;&#38754;&#25490;&#21015;&#20998;&#21035;&#26159;Na, Nb, Nc</span>
            <span class="org-comment"># &#37027;&#20040;&#24635;&#25490;&#21015;&#26159; (A+B+C)! / (A! * B! * C!) * (Na * Nb * Nc)</span>
            <span class="org-py-variable-name">n</span> = <span class="org-py-number">0</span>
            <span class="org-py-variable-name">b</span> = <span class="org-py-number">1</span>
            <span class="org-keyword">for</span> c <span class="org-keyword">in</span> t.child:
                compute(c)
                <span class="org-py-variable-name">n</span> += c.n
                <span class="org-py-variable-name">b</span> = (b * rev[c.n] * c.val) % MOD
            <span class="org-py-variable-name">t.n</span> = n + <span class="org-py-number">1</span>
            <span class="org-py-variable-name">t.val</span> = (fac[n] * b) % MOD
            <span class="org-keyword">return</span>

        compute(trees[<span class="org-py-number">0</span>])
        <span class="org-py-variable-name">ans</span> = trees[<span class="org-py-number">0</span>].val
        <span class="org-keyword">return</span> ans
</pre>
</div>
</div>
<div id="content"><!-- DISQUS BEGIN --><div id="disqus_thread"></div><script>/***  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/var disqus_config = function () {this.page.url = 'https://dirtysalt.github.io/html/lc-1916-count-ways-to-build-rooms-in-an-ant-colony.html';this.page.identifier = 'lc-1916-count-ways-to-build-rooms-in-an-ant-colony.html';};(function() {var d = document, s = d.createElement('script');s.src = 'https://dirlt.disqus.com/embed.js';s.setAttribute('data-timestamp', +new Date());(d.head || d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><!-- DISQUS END --></div></body>
</html>
