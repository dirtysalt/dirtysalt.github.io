# Chapter 1: 戴夫·普卢默的编程人生：从TRS-80到Windows传奇

这是一段与传奇程序员戴夫·普卢默的对话，他不仅是微软的资深软件工程师，更曾深度参与Windows 95、NT和XP系统的开发。他创造了无数令人惊叹的工具，其中一些至今仍被数亿人持续使用，比如我们熟知的Windows任务管理器，以及Windows内置的zip/unzip压缩支持功能。他还曾将经典的《太空军校生弹珠台》（即Windows三维弹球）代码移植到Windows平台。如今，他凭借精彩的YouTube频道“Dave's Garage”深受程序员和工程师们的喜爱。此外，他还撰写了一本关于自闭症的书籍——《自闭症百万富翁的秘密》，书中分享了他在自闭症状态下经营人际关系、事业和日常生活的独到见解。这场对话无疑是一次关于编程历史与未来、计算机技术以及如何在传奇车库中打造酷炫产品的超有趣探讨。

故事从戴夫·普卢默的第一台电脑说起。他回忆道，虽然很久之后才拥有自己的第一台电脑，但最早接触的是一台TRS-80 Model 1，一台一级4K内存的机器。那是在他五六年级，大约11岁的时候，他骑着自行车去了当地的RadioShack商店。店里除了标准的组合音响系统，还有一摞标着“电脑”的箱子。他向店员询问，得知设备刚到还没设置好。早熟的戴夫主动提出帮忙设置，尽管他当时对电脑一无所知。他发现Tandy公司“智慧地”使用了相同的五针DIN接口来供电、视频和连接卡带机，如果插错接口设备就会烧毁。他仔细查看标签，成功将其设置好。起初，他对电脑一窍不通，尝试用英文指令与它交流，比如输入“PRINT 2+2”可以运行，但用这种基础的一级解释器，简单的英文指令并不能走多远。他至今还保留着六年级时写的一份逻辑上不太严谨但勉强能运行的程序，尽管它在当时任何解释器上都无法运行。他花了些时间才弄清楚电脑的实际运行原理，每周四和周六都会骑车去RadioShack，店员也很慷慨地让他使用那台机器。那是1979年到1980年间。

谈及当时的计算机技术水平，戴夫指出，三大巨头——TRS-80 Model 1、PET 2001和Apple II几乎同时问世。当被问及哪台是史上最伟大的计算机时，戴夫认为可能是Commodore 64，因为它影响了更多人，销量也更高，尽管Apple II对个人电脑历史产生了巨大影响。Lex也同意，Commodore 64是他的第一台电脑，确实了不起。

戴夫后来升级到了Commodore 64。他做的第一件事就是不小心烧坏了软驱，这很不幸，因为机器不在保修范围内（是从Computer House而非大型零售商购买的，需要送回德国修理）。没有软驱，他只能使用磁带录音机。他开始编写小程序，用磁带加载机器语言监视器。虽然没有内置汇编器，但它带有一个反汇编器，让他能够以十六进制输入6502的操作码，从而编写一些基础程序。他就是这样入门的。他在上面写的第一个程序是《Galaga》的拙劣克隆版，包含了随时间推移发动攻击的主要敌人，全部是用手工编写的机器语言完成的。由于6502处理器不支持代码重定位，他不得不手动跳转到别处完成工作再跳回，代码因此变得一团糟，但最终还是跑通了。然而，在备份时，他犯了一个致命错误——将空白软盘的内容复制到了存有数据的软盘上，导致他永远失去了自己第一个程序的副本。那种感觉，他形容为“像个傻瓜一样”，充满了内疚，因为“毁掉了好几周的工作”，只因“太着急”或“做了些蠢事”。

他解释说，那真的是纯粹的6502机器语言，甚至不是汇编语言，因为当时还没有内置汇编器。他本该先写一个汇编器，但当时他没那么聪明。用机器码编程最大的局限性是必须完全按顺序编写代码，无法在之后添加内容，只能在末尾添加，就像编程磁带一样。那个《Galaga》克隆版，是他用机器语言构建过的最复杂的东西。

戴夫爱上编程分两个阶段。从TRS-80 Model 1开始，他就清楚地知道这些机器令他心驰神往，唯一的愿望就是骑车去那里，花更多时间与它相处。另一个顿悟时刻是在大学二年级或三年级时，他意识到自己热爱编程，但完全不知道将来要做什么，是去捣鼓录像机上的12点闪烁显示，还是去开发操作系统？他毕业后究竟要做什么，完全没有头绪。但他热爱自己所做的事，这给了他很大的安慰，让他相信只要跟随这种直觉指引，最终会找到方向。

戴夫高中辍学了，他承认这不是最明智的选择。他并没有一个明确的辍学时刻，只是去的次数越来越少，直到有一天意识到如果突然出现会很尴尬，因为已经太久没去了，很快就彻底不去了。辍学后，他不得不找工作，于是去了7-Eleven便利店和油漆仓库等地打工。在7-Eleven工作其实挺有意思的，夜班需要处理所有会计和行政工作，通常会轮换给那些足够聪明的人，但这些人选择在7-Eleven工作都有各自的个人原因，戴夫就是其中之一，因为他没有高中文凭。

在7-Eleven工作期间，最糟糕的时刻不是被持刀抢劫之类的刺激事件，而是测油井倾斜度。他需要用一根大约15到20英尺长的木棍，上面标着刻度，放进油箱测量汽油液面。有一次，量油杆脱手滑落，他赶紧重新抓住，结果手上扎满了木刺，当时零下40度的低温让这糟糕透了。那一刻，他突然意识到：“我不想一辈子都做这个。”他明白必须做出改变。尽管已经21岁，他还是去见了当地高中的校长，询问是否能重新入学。校长说他年龄太大了，也没有名额。戴夫坚持说：“从现在到那时，总会有人退出的，所以你会有位置的。那么假设你有空位，我能回来吗？”校长很和善，允许他回来，于是他补上了需要的三四节课。戴夫反思道，这是大脑能做的一件奇妙的事，你会意识到不必随波逐流做大家都在做的事。这既是危险的认知，因为某种程度上你必须融入社会才能完成某些事情；但如果你意识到不必随波逐流，那么你的人生要么会精彩绝伦，要么将举步维艰。而这个过程，往往只是从一个微小的决定开始：“我今天就不去上课了。”

# Chapter 2: 突破常规：从萨斯喀彻温到微软的非凡旅程

人生中，总会有一个瞬间让你意识到，你不必随波逐流，做大家都在做的事。然而，这恰恰是一个危险的认知。因为在某种程度上，你必须融入社会才能完成某些事情。一旦你真正意识到不必随波逐流，你的人生要么会精彩绝伦，要么将举步维艰。这个过程往往始于一个看似微不足道的小决定，比如一句“我今天就不去上课了”。这似乎只是一个简单的选择，但当你重复多次，实际上便是在做一个更大的、未经深思熟虑的决定。因此，最好能明确地做出决定。如果你想以非标准的方式生活，就应该明确做出重大的决定，然后坚定不移地走下去，避免让那些小错误日后找上门来。

回顾我的学生时代，我曾是一个糟糕透顶的高中生。即便进入大学第一学期，我依然没有认真对待学业。我记得有一门几何90的补修课，相当于我高中12年级没上的几何课，老师仁慈地让我及格了。这让我感到后怕，因为我意识到自己只差1%——或者说全凭那位教授的仁慈——就可能断送整个大学生涯。幸运的是，这些补习课程的成绩不计入成绩单，我获得了重新开始的机会。在新学期，我真正为自己而学，一切都变得不同了。对于如何成为一名成功的学生，我的建议是：理想情况下，你应该找到学校里某个你真正喜欢的方面，无论是艺术、计算机科学、工艺课还是其他任何课程。去上这些课，并坚持完成那些困难的内容，因为这比以后不得不补要容易得多。这话从一个50多岁的人嘴里说出来当然轻松，但对于15岁左右的年轻人来说，确实很难做到，但它非常有道理。

那么，我是如何从萨斯喀彻温省的一个普通学生，一路走到微软的呢？这是一个巨大的跨越。当时我重返校园，大约在大学三年级的时候，暑期我在一家电话公司打工。我的任务是将他们的UBNET系统转换为TCP/IP现代网络协议，这实际上就是更换硬件卡件，然后排查配置问题。那时的系统已经不再允许Lotus运行，因为它的性能比从前差了许多，所以那真不是从事计算机工作的好时候，但我还是坚持了下来。午餐时分，我坐在美食广场，周围都是些上了年纪、百无聊赖的人，我正在读一本买来的书，书名大概是《微软或比尔·盖茨与微软硬盘的诞生》。这是一本很棒的书，它只是实事求是地记录了微软的崛起历程，包括公司的运作方式、内部文化以及员工风貌。我完全被它迷住了，因为它描述的地方正是我心之所向。但我身在萨斯喀彻温省，又能怎么办呢？

最终我采取的行动是，通过一个名为HyperCache的项目半工半读完成学业。这是一个为Amiga计算机设计的文件系统缓存，因为Amiga电脑开箱即用的功能有限。这个项目表现相当不错，于是我开始整理用户登记卡。那时候，每张4x6英寸的卡片都需要用户填写姓名、地址，如果有电子邮箱的话还要填写邮箱地址。他们提交后，会收到更新通知等等。我翻遍了整个技术栈，寻找任何带有微软邮箱地址的人，结果只找到大概三四个人。我就直接给他们发了冷邮件，说：“嘿，我是萨斯喀彻彻温省的一名操作系统专业学生，正在寻找机会。”我不太记得当时具体说了什么，但有个叫阿利斯泰尔·班克斯的人回复我说：“我认识个人可以帮你牵线联系。”是他帮我牵线搭桥，联系到了一个叫本·斯利夫卡的人，他对我进行了电话面试，最终想雇我在暑期从事MS-DOS方面的工作。就这样，我靠自己的力量得到了这个机会。

HyperCache这款软件，堪称硬盘的“瘦身程序”，它对足够多的人确实有用，以至于他们愿意为此付费。我确实赚了不少钱，卖出了几千份，每份20美元或40美元。这个程序是用C语言编写的，但也用了一些汇编语言。实际执行数据进出缓存的核心代码仅有68行汇编语言，其余部分都是用C语言编写的。它处理的是设备块I/O，任何从驱动器处理的块都会先经过我的缓存。这是一个N路组相联缓存，它会尝试匹配驱动器的几何结构并基于此进行预取，比如试图一次性读取整个轨道。

当时尝试把我的软件推广出去也很有意思。我记得最早是在Usenet和一些Amiga论坛上发帖说：“这是我的试用版，30天免费试用，看看你喜欢哪些功能。”后来有几家零售商开始进货销售。我记得当时我和现在的妻子一起坐在她的车里，她有一部手机，因为她父亲非常担心她的安全。那是80年代末，她车里装着一部车顶有天线、后备箱里还有个大大的机箱的手机。我们接到一个软件零售商的电话，他们想以20美元的价格购买50份。对我来说，这就是一千美元，在1989年，这是一件大事。所以最终不少公司直接采购了大量库存。

回到那个时代，那是个非常有趣的时期，比尔·盖茨和微软正如日中天。我认为当时微软之所以能在软件和个人计算领域占据主导地位，并在之后的很多年里都保持着这种优势，是因为那是我参与过的最为强大的精英团队集合。我也曾在学术界和工业界有过一定经历，你知道，当你在普通计算机公司工作时，那个真正懂行的家伙，他那个更聪明的朋友，他八成在微软工作吧。所以当你到了那儿，就成了小地方来的大人物，你以为自己懂得很多，突然间，你发现自己所处的环境让你觉得：“呃，我还是别开口了，免得显得很蠢。”

比尔·盖茨本人呢？我认为他对自己梦想的追求始终不懈，这个梦想正是他早年提出的口号：让每个家庭、每张办公桌都拥有一台电脑。这是一种非凡的执着。他是个聪明人，而且极其坚定，他雇佣了与他同样聪明甚至更聪明的人来协助执行。他打造了一台几乎不可阻挡的智力机器去创造，可以说是非常简单的产品。MS-DOS绝非复杂的产品，但它正是当时市场所需要的。MS-DOS确实改变了游戏规则，而我加入的正是那个团队——MS-DOS团队，我记得是在Windows 95发布之前。

MS-DOS的成功对微软的成功起到了关键作用。在DOS之前，他们主要是一家语言公司，为许多电脑开发了BASIC语言，还拥有Fortran编译器和Pascal编译器这类产品。但他们让MS-DOS成为每台PC标配的协议，实际上确立了他们的行业标准地位。这个优势让他们得以在之后几十年里持续获益。在一定程度上，他们算是幸运地碰上了这个机会，而从另一方面来看，他们这么做确实很聪明，因为我听说他们并没有向IBM收取太多费用，但将其确立为标准确实在长期发展中给他们带来了优势。那时候的MS-DOS还没有图形界面，它本质上是个命令启动器。你输入命令名称来操作，它会检查该路径是否在当前目录或特定的文件夹路径中，并将其加载到内存中，如果存在则执行。这就是MS-DOS 90%的功能。它现在拥有环境变量和一些复杂性，还内置了一个小型脚本语言，但本质上它只是一个允许你操作的操作系统外壳，利用计算机的资源，比如硬盘或CPU，但它不允许你进行多任务处理。后来，微软确实在DOS 5中为编辑器和QuickBASIC等程序添加了基于文本的图形界面。我相信，当时确实有一个DOS shell，它在MS-DOS 4.0中算是一种图形化的文件管理器，所以他们尝试过这个方案，但主要还是命令行界面。它也能进行通信，比如外部设备和驱动程序。

MS-DOS这个操作系统有多庞大呢？它受限于最初的x86指令集，这限制了它只能使用640K内存，然后在此基础上还有各种临时解决方案来实现高内存，甚至进一步扩展内存。而且，要让任何程序在不占用基础内存的情况下运行，都需要费尽周折。640K是永远可用的最大内存，所以这不是操作系统开发者能随意使用的资源，因为你所用的正是用户无法获得的。因此，如果你不必要地消耗了10K资源，那么全球每台机器都将因此减少10K可用资源，这确实是项重大责任。至于那句“没人会需要超过640K内存”的说法，虽然常被归到比尔·盖茨名下，但并非事实，他并没有说过这句话。

我在实习期间以及加入MS-DOS团队后，有哪些特别有意思的工作经历可以分享呢？我最初接手的工作之一就是负责SmartDrive这个磁盘缓存程序，因为我对磁盘缓存比较熟悉，并且为它添加了CD-ROM缓存功能，因为这项技术当时还是新鲜事物。CD-ROM驱动器那时才刚刚问世，微软书架（Microsoft Bookshelf）是少数几个能在其上运行的应用程序之一。正如你所想象的，如果处理得当，为CD设置缓存可以将其运行速度提升数十倍。所以，这是一个显著的性能提升，也是值得投入的工作。其中更重要的部分是将大量SmartDrive以及最终的双倍间距压缩引擎迁移到所谓的高内存区域。在不深入探讨技术细节的情况下，在x86架构上，存在某种机制，我相信称为A20线。如果你启用了A20线，那么你的内存指针会在1MB标记处回绕。如果没有，它们就不会，因此它会继续在内存中向上增长。所以你可以通过将段寄存器和偏移寄存器组合成一个大于1MB的数字来重写上方内存，这样你就获得了额外的64K空间，将代码放入其中，然后只需在低内存中放置跳转到该代码的存根即可。这样你就能从机器中再榨取出64K内存。我们为几款产品都采用了这种做法。我当时完全不懂什么是高端内存，因为我之前是Amiga程序员，在加入之前从未写过任何x86代码。

# Chapter 3: 从内存优化到操作系统巨擘：一位微软工程师的黄金时代回忆

在早期的计算机编程中，内存管理是一项精细的艺术。他回忆道，当时如果内存指针在1MB标记处回绕，程序行为会受限；但如果能避免回绕，程序就能在内存中持续向上增长。通过巧妙地将段寄存器和偏移寄存器组合成一个大于1MB的地址，程序员可以重写上方内存，从而额外榨取出64K的空间。他们会将代码放入这额外的64K中，然后在低内存中放置一个跳转到该代码的存根。这项技术为几款产品都带来了显著的性能提升。

对于当时刚从Amiga平台转来、从未编写过任何x86代码的他来说，高端内存的概念完全是陌生的。能参与到这种级别的优化工作中，他感到非常酷。

与此同时，Windows 95的开发也在如火如荼地进行。他有幸参与其中，在COM/OLA团队工作了大约三四个月。他的主要任务是负责演示缓存功能，例如当用户在Word文档中插入Excel电子表格或图表时，无需每次都加载整个Excel程序来渲染，而是通过增强型图元文件实现渲染缓存。这项功能随Windows 95一同发布。然而，在加入微软大约六个月后，他转到了Shell团队，并从此开始从事NT系统的工作。

他解释说，Windows 95是16位Windows 3.1的重大升级版，而3.1是Windows最早流行的版本。95引入了32位支持、VXD驱动程序、一系列新技术以及全新的用户界面，这在当时是革命性的。人们甚至彻夜排队购买这款产品。与苹果早已拥有的图形界面不同，Windows 3.1也拥有图形界面，但Windows 95的飞跃在于其全新的用户界面，尤其是“开始菜单”。当他第一次看到它时，就意识到自己想成为其中的一部分，尽管无法具体说出它有何不同和出色之处。这种着迷促使他开始编写一个后来演变成zip文件夹的shell扩展程序。最终，他加入了将这个新shell移植到NT系统（即今天的Windows）的团队。

谈到史上最具影响力的操作系统，他认为Windows 95位居第二。他将OS/360列为第一，因为它在1962年编写的COBOL程序至今仍能在IBM大型机上运行，其对商业领域的影响深远，堪比Windows 95对家庭用户的影响。Linux则排在第三位，尽管没有Unix就没有Linux，但Linux以其最大规模的开源精神、社区建设和编程理念，对服务器端产生了无处不在的渗透，甚至可以说“宇宙中不为人知的秘密都运行在Linux系统上”。

回到MS-DOS和Windows 95时代，一个高效的工作日是这样开始的：每天上班第一件事就是下载通讯录。当时微软有1万到1.5万名员工，都使用MSMail系统。由于当时使用的是10兆比特的网络，下载通讯录常常要花掉第一个小时，这总是令人沮丧。不过，他会利用这段时间查看夜间“压力测试”（NNT）中可能发生的崩溃。NNT会让所有闲置机器整夜运行测试，试图让系统崩溃。如果崩溃发生，调试器会通过串行电缆连接到另一台机器，允许远程调试。他到岗后，首先要对这些错误进行分类处理，比如“开始菜单崩溃了，分配给戴夫”。连接并解锁机器，将机器归还给主人，这就是每天的第一个小时。之后，他才能回到编码工作。遗憾的是，他职业生涯中80%的时间都在修复漏洞，尤其是在移植代码和修复漏洞方面，很少编写新代码。不过，他私下里会编写很多新代码来释放压力，摆脱日复一日为他人代码修复漏洞的繁琐工作，这也是绝佳的学习机会。

在微软期间，他主导了大量的移植工作，主要是将Windows 95的用户界面移植到NT系统。这意味着首先要将其转换为Unicode编码，将所有8位数据变成16位，指针也随之改变。他形容转换代码的过程相当混乱，就像闯入别人家里，翻遍他们的物品，看到他们不想让你看到的抽屉里的东西。你会发现墙上挂着的漂亮画作，也会在床头柜里发现一些令人不安的东西——比如200多个字符宽、夹杂着各种脏话和咒骂的代码。虽然到他离职时这些代码已被清理干净，但这并不总是世界上最专业的代码。他强调，逐行检查代码让他看到了所有内容，也印证了程序员的普遍经历：你写了一段代码，以为永远不会被任何人看到，但很多时候，这段代码会被很多人看到，甚至五年后的你自己也会受到影响。

Windows NT是另一个巨大的飞跃，它基本上是一个全新的设计。微软为此请来了数字设备公司（DEC）的戴夫·卡特勒（Dave Cutler），他曾为DEC开发过VMS和RSX-11等操作系统。在DEC的Prism和Mica项目被取消后，戴夫·卡特勒带着一大批DEC的顶尖高手加入了微软。他们从零开始，以OS/2作为起点（尽管OS/2是用汇编语言写的，而NT将用C语言编写），构建了NT系统。戴夫·卡特勒是NT内核架构的设计师，相当于Linux领域的Linus，是Windows世界的戴夫·C。尽管有许多人做出了贡献，但他认为戴夫·卡特勒是背后的推动力，至今仍是。据他所知，85岁高龄的戴夫·卡特勒作为微软院士，至今仍每天坚持写代码。

他形容戴夫·卡特勒聪明绝顶，但也像个农民一样务实。他会像监工一样盯着你，确保事情不仅完成还要做对，绝不允许任何垃圾代码混进他的操作系统。在这方面，他是个不折不扣的严师，但这非常值得，因为它让微软开发人员经历了巨大的范式转变，体验了戴夫·卡特勒带来的数字设备公司式领导风格。

从与戴夫·卡特勒等杰出工程师共事、创建全新系统的经历中，他领悟到优秀软件工程团队成功的关键首先是工具集，其次才是人。他回忆道，当时如果能有源代码分支这样的奢侈功能，工作会容易得多。他还分享了一个难忘的对话：当时有人抱怨NT系统的启动体验很糟糕，而一位参与Cairo项目（一个未能实现的下一代操作系统项目）的工程师在NT开发公开邮件列表上大放厥词。结果收到了一封史诗级的骂战邮件，堪称艺术杰作，情绪与Linus偶尔发的咆哮邮件非常相似。他承认，工程师之间确实有过激烈的知识分子辩论，争论有时会变得非常激烈，以至于技术优势反而成了次要的，重点变成了在辩论中胜过对方，这往往导致争论失去建设性。

# Chapter 4: 工程师的较量、调试的磨砺与任务管理器的诞生

在工程师的世界里，激烈的争论屡见不鲜，有时甚至会失去建设性。才智之士相互较量，技术优势反而退居其次，重点变成了如何在辩论中胜过对方。这种现象在编程语言设计社区尤为突出，连像吉多·范罗苏姆这样的社区领导者也会因此精疲力尽，因为人们常常会忘记最初的使命，转而对语法上的细微差别吹毛求疵。

我本人也曾深陷其中，甚至输掉了一场至今仍耿耿于怀的争论。那是在Windows 95开发的后期，我们正将所有内容从ANSI编码转换为Unicode编码，这意味着每个8位字符都变成了16位。当时我正在MIPS架构的机器上工作，这种RISC平台不允许使用未对齐的地址。问题出在处理ID列表时，比如C盘、Windows目录、System32等路径组件。如果字符数是奇数，那么在内存中，这个结构就会处于奇数地址位置。这导致我需要付出巨大的努力来开启异常处理程序，进行非对齐字节访问，手动提取和复制字符串。毫不夸张地说，在R-MIPS机器上从这个ID列表中读取字符串的工作量是正常情况的百倍到千倍，仅仅因为没有对齐。我当时极力主张，即使开发已进入后期，也应该确保ID列表始终是偶数个字节，或者采取某种变通方法，这样引用它们的代码就能快速推进。然而，这场争论最终演变成了一场带有私人恩怨的争吵，而我输了。时至今日，我依然认为，那些在Windows上运行的代码比它应有的速度慢了成千上万倍，尽管没人关心，因为它“已经够快了”，但它本可以快得多。

在NT系统开发时期，要成功理解并构建软件，需要对底层有极深的理解，包括软件甚至硬件的最底层。我们大约一半的时间都花在调试上，而且大部分调试时间都泡在纯汇编语言的调用堆栈里，因为那时根本没有源代码级调试器。即使是用C语言编程，调试时也必须看汇编代码。更具挑战性的是，我们还要处理四种指令集架构：英特尔、MIPS、Alpha和PowerPC，这意味着你需要精通完全不同的指令集和寄存器。这无疑是一场耐力考验，调试的折磨，尤其是在没有配套工具的情况下，是编程的本质之一。

我可以说，我的职业生涯中20%的时间在创造，80%都在调试和修复问题。我因此有了个解决问题的名声，所以这类事情总会找上我。我并非那种以创意UI设计闻名的天才，但我专注于修复那些不够美观的设计，并在这方面变得非常擅长。这种工作虽然不介意，但当遇到那种你花了太长时间却不知下一步该怎么做，既搞不懂为什么它不工作，也不明白它之前是怎么正常运行的困境时，一整天下来，确实相当折磨人。调试代码简直是种酷刑，它可能非常、非常困难，其中还包含心理层面的坚持不懈。

我曾遇到一个令人啼笑皆非的bug，它并非我的代码问题，而是任务管理器本身偶尔会显示“CPU总使用率超过100%”。这在任务管理器中看起来相当荒谬，我花了很长时间试图解决。我向内核开发人员反映过，但他们并不以为然，认为这是我的用户态问题。我对此非常确定，于是在代码中不断添加断言，确保将材料相加的预备步骤和最终总和都从未超过100。断言从未触发，但bug依然偶尔出现。于是，我在断言里加上了我的电话号码，心想：“如果你看到这条消息，就给戴夫打电话，号码是425-836-我的电话号码。”最终，在一次实际的压力调试中，有人连接着调试器遇到了这个问题，我们终于捕捉到了它。结果查明这实际上是一个内核记账问题，而非任务管理器的问题。在证明这是内核问题后，他们就在内核中修复了它。你可能会认为我们会删除我的电话号码，但我们只是把它注释掉了，所以它被发布出去，并出现在所有泄露的NT源代码中。有趣的是，我后来甚至可以通过在谷歌搜索我的电话号码来反向查找NT源代码。

谈到断言，我对此有点执着。我不会对那些我希望不成立的事情做断言，我只对那些明知不可能成立的事情做断言。我认为这才是断言的真正本意——当这种情况发生时，它就是一个bug，简单明了，而不是警告。断言本身就是一件严肃的事情，因为它会完全停止所有执行，迫使你解决问题。它能很快帮你找到问题的根源。我建议在编写代码时就反复这样做，在构建过程中就为每个函数添加前提假设的断言，比如指针永远不会是空值，计数总是小于某个值。别害怕，因为如果它断言了，它其实是在帮你。

最后，不得不提我开发的传奇程序——Windows任务管理器。它是一种可以查看系统中哪些应用程序正在使用计算机资源（包括硬件、CPU和内存），哪些进程可能占用过多资源、被锁定或出现异常，并允许你终止这些进程的工具。它既是检查工具也是修复工具。我很幸运能参与开发许多大家耳熟能详的项目，而任务管理器正是这些个人兴趣项目之一，最初只是为满足自己的需求而开发，最终被公司采纳为正式产品。

我当时在家编写代码，逐步实现了基础功能框架。由于无法访问内部API，我最初使用的是注册表中的`HKey Current Perform`或`HKey Performance`来获取统计数据。后来当我把它引入内部系统后，就能直接调用`NtQuerySystemInformation`或`NtQueryProcessInformation`这类函数快速获取真实数据了，这使得它成为一个非常快速且响应灵敏的应用程序。人们开始依赖它，因为我编写时就力求让它尽可能可靠、健壮且小巧。最初的版本大约只有87KB。

要开发这样一款不会卡死的软件，关键在于不要做太多假设。如果你打算通过shell调用来运行应用，那可能是个基于TCP/IP共享的网络路径，需要90秒才会超时。所以，每当你执行这类可能耗时的API调用时，都需要在单独的线程上完成这个操作。因此，应用程序会变得稍微复杂一些，因为所有操作都是多线程的。我用C++编写它，最初在NT 4.0中发布。

为了让它尽可能简单和稳健，我实施了一些现在看来有点“硬核”的优化。我根本不想链接到C运行时库，所以我确保绝不调用任何运行时函数，也没有链接它们，这让我省去了C运行时库大约96KB的开销。因此，我小心翼翼地避免这样做，尽管我是在用C++编写，但它更像是带对象的C语言。为了让它能运行起来，我不得不手动从调度表里剔除所有对象构造函数之类的，因为没有运行时环境帮你处理这些。这需要大量额外工作才能让它运行起来，但当你做到时，它的体积会变得非常小巧。

# Chapter 5: 代码深处的记忆：一位微软工程师的传奇旅程

我的职业生涯中，曾有一段时期，我小心翼翼地避免使用完整的C++运行时环境，因为我当时编写的程序更像是带对象的C语言。为了让它能顺利运行，我不得不手动从调度表里剔除所有对象构造函数之类的东西，因为没有运行时环境能帮我处理这些。这意味着我使用的编译器并没有自带运行时。虽然我不想在技术细节上钻牛角尖，但这确实需要大量额外工作才能让程序跑起来。然而，一旦完成，它的类型会变得非常小巧，程序体积也因此大大缩减。

谈到程序，我曾参与开发任务管理器，那段经历至今仍让我津津乐道。追踪每个进程及其CPU占用率，比如每个进程占用了多少CPU，这其中有很多有趣的地方。我见过最酷的事情之一，虽然我不想说汉明码是我发明的，但我确实是在不知道汉明码存在的情况下，自己琢磨出了类似汉明码的东西。任务管理器里的每一列和每一行都有一个标记位来表示是否变脏。然后，我可以用和汉明码检查X/Y列相同的方式，找出哪些行发生了变化，从而遍历并确定哪些部分真正需要重绘。因此，任务管理器效率极高，它与ListView控件协同工作，能够实现逐帧遍历并仅重绘发生变化的单个单元格的功能。这使得绘制速度飞快，调整尺寸时也能保持流畅，而尺寸调整可能是我使用该应用最大的个人目标。所以你可以调整到任意尺寸，它依然能正常工作。即便你有32个CPU（这在当时是不可能的），它也只会绘制八个图表然后自动换行。但它至今仍能正常工作，所以我对此还挺自豪的。这太不可思议了，我亲眼见证了任务管理器的演变历程。从某些方面来说，它其实变化并不大，或许只是界面变得更美观了些，以适应不同版本的Windows系统。但功能上基本是一样的，只是现在报告了更多信息，因为他们添加了GPU和散热之类的东西，这些确实是很不错的功能，而我们那时候还没有。至于代码，据我所知，原始代码大部分都还在那里，所以有绘图代码层、暗黑模式代码层以及其他各种代码层，比如XML模式代码，这使得文件大小从87K膨胀到了4MB。但这就是我们生活的世界，没办法。这就像那种你开发完就直接搁那儿的软件，一旦安装就固定在那里，简直就像开始菜单一样。我敢肯定如果你去掉它，人们会发疯的。是的，这个可能会被锁定一段时间，或许还不错。我原以为Clippy也会如此，不过，呃，Clippy总有一天会卷土重来的。

除了任务管理器，我还参与了《太空军校生三维弹球》的开发，至少是移植工作。当时，他们来到我的办公室问我在忙什么，我告诉他们后，他们又问我接下来三个月想怎么安排。我还没想好，他们就问我想不想移植《Pinball》。我曾见过《太空军校生弹珠台》作为Win95平台的独立游戏，它有几个不同的弹球台，是个很酷的游戏，所以我当时还挺兴奋的。他们想要的是为NT系统制作一些视觉特效来展示NT系统的能力，那时需要高速图形处理，或者至少是响应迅速的图形。于是我尝试了一下，但很不幸，大部分代码是用汇编语言写的，而我用的是MIPS架构，所以不得不先用C语言重写代码，这样才能移植到所有不同的平台上。游戏的核心是一个庞大的状态引擎，就像一个巨大的switch语句，如果我没记错的话，里面大约有50个条目。而且它还内置了一个彩蛋。解码状态的过程，就像让神经网络处理不同状态输入一样，我只是把它放在一边，当作一个黑箱来处理。因此我的代码在此基础上运行，负责绘图、音效等其他所有功能，但原始游戏仍在运行中。最近有人问我，为什么物理效果与Windows 95版本略有不同，但代码应该是相同的，因为我非常努力地想要保持原样。其实是因为我有个bug，导致它会尽可能多地绘制每秒帧数。在现代计算机上可以达到5000帧每秒的弹珠游戏性能，因为这是个相当基础的游戏。因此所有物理效果都是以5000次/秒而非30次/秒的频率进行插值计算，或者你在旧版本中能得到的任何东西。所以你得到的可以说是更好的，或者至少是不同的物理效果。但他们后来修复了这个问题。我认为这是个很棒的设计，这并非我的功劳，完全归功于Cinematronics团队的那些人。原版游戏的设计确实非常出色，这和我实际拥有的弹珠台实物《Black Knight 2000》非常相似，而且两者的布局也确实很相近。我不确定它是否受到了前者的启发，总之这是款不错的游戏。有时我会想到像俄罗斯方块这样的游戏，那些图形相当原始却能让大批人感到兴奋。或许正是大批人的这种兴奋感造就了游戏的非凡魅力，那种会深深印在你脑海里的东西。但那可是经典游戏之一，就连像纸牌和扫雷这样的游戏，有一代人可是在扫雷上打过仗的。原来这些程序被内置在操作系统中并非作为游戏，而是作为教育工具来帮助你学习使用鼠标。哦，有意思。所以纸牌游戏是为了教你如何进行拖放操作，而扫雷大概是为了练习右键点击。我觉得你放了个对的东西，一个标志或某个物品。我不是扫雷高手，但每个游戏都能教会你一些东西。这挺有趣的，哇，这个我还真不知道。但我不知道在这些游戏上花了多少个小时，就像无数人花费了无数时间在这些游戏上。我曾经在孩子学校志愿教授计算机科学课程，就是给三年级小朋友上的那种课，其实更像是教他们登录操作而非真正的计算机科学。但是，呃，这些孩子的老爸们都在微软上班，所以你做什么他们都不会觉得厉害。不过有个孩子发现我参与过《弹珠台》开发后，他们的反应就变成了“哇！你做过《弹珠台》？”因为那时候所有孩子都知道这个游戏。现在这些孩子可能已经过了那个年纪，他们不知道这事了，但曾经有那么一小段时间……

你卡在Windows激活那一步了？你说得好像这是件坏事似的。嗯，一切取决于你看问题的角度。那就讲讲这个故事吧。Windows激活是怎么回事？我是怎么参与进来的？他们是在XP开发后期才找到我的。我不确定测试版是否已经发布，我认为测试版应该还没发布。但他们原本计划采用Office的激活码机制，然后将其适配到Windows系统中，为Windows添加激活功能。但负责此事的人已经多次疏忽，导致这事不可能完成了。因此我有了个能快速解决问题的名声，所以他们来找我说：“你能在XP发布前搞定这个吗？”“我不确定，但我会尽力。”于是在负责DRM的团队和研究产品密钥数学算法的团队协助下，我们赶在XP发布前及时完成了。我不知道它对收入的实际影响有多大，但当你开始强制执行许可证密钥时，我想影响会相当大。我很好奇那到底是什么。我不知道。因为这也很烦人。确实如此，尤其是当你必须通过电话激活时。而这正是我们不得不随身携带的沉重负担，必须将数据上传到清算中心，将批准你密钥的后端系统。你必须提供所有硬件参数，比如内存大小、硬盘空间以及硬件密钥绑定的各种参数，还有产品密钥，并且需要将其编码成字母数字组合，以便有人愿意通过电话读取。如果你觉得通过电话进行产品激活很痛苦，你能想象在电话那头工作的人是什么感受吗？我是说，每天听8小时产品密钥，这工作简直让人麻木。是的，这是Windows面临的挑战之一，这对我来说一直是个令人沮丧的点，但我从设计角度能理解，这确实非常困难，因为有太多不同类型的人在使用Windows。但随着时间的推移，Windows越来越倾向于那种令人不适的方向，这实在令人沮丧，算不上高级用户，我应该说。这就是为什么Linux一直都很棒。但从激活角度或任何配置方面来看，它确实是个让人相当头疼的问题。

最近我比较受欢迎的一期节目是关于为什么不能移动Windows任务栏的。是的，我原本不知道，但人们对这件事的愤怒情绪是显而易见的——确实如此。你只是想把它放在左侧或顶部，但现在却不行了，这对他们的存在简直是一种冒犯。在一定程度上我能理解这一点。嗯，这是让我非常不喜欢Windows 11的很多方面之一，其中之一就是你无法像以前那样自定义任务栏的位置。这些本该是最基本的自定义功能。我们能直接配置这些吗？因为只要给高级用户这个选项，就会有一小部分人超级喜欢这个操作系统，这对你没有任何损失，给他们这份自由就好。不过，这确实是有代价的，对吧？因为把开始菜单放在左边、顶部或右边的自由，确实增加了渲染开始菜单、布局标签页等功能的代码复杂度。现在出现bug的可能性大大增加，而且需要维护的代码量也大幅上升。所以你很可能需要更多开发人员或再招一名开发者，或者占用开发者的一部分时间。那么问题就变成了：在什么情况下，满足一小部分用户的特殊需求仍然是值得的？而我……我只是……这些决定并不由我来做，但我能从双方的角度来看待这件事。我认为就像那些制作电影的人一样，他们会插入非常微妙的细节，只有少数人会意识到这些细节的存在，这最终会带来丰厚的回报。随着时间的推移，会建立起一种声誉，这种声誉会产生非常强大的连锁效应。我觉得它确实带来了诸多好处，尤其是在招聘优秀软件工程师方面。就像你为这个地方营造了一种氛围，把爱倾注到每个细节中，这确实满足了高级用户的需求，这照顾到了开发者的需求。我认为微软正越来越朝着这个方向发展，通过GitHub平台以及收购GitHub，专注于服务开发者群体。但在Windows用户界面方面，拜托，还差得远呢。

# Chapter 6: 从软件匠心到蓝屏死机：一位微软工程师的开发故事与洞察

故事始于对软件开发哲学的深刻探讨。有人认为，将“爱倾注到每个细节中”最终会带来“丰厚的回报”。这种精益求精的态度能建立起强大的声誉，产生连锁效应，尤其在吸引优秀软件工程师方面，因为它为产品营造了一种独特的氛围。这种理念不仅能满足高级用户的需求，更能照顾到开发者的需求。

微软正日益朝着这个方向发展，通过GitHub平台及其收购，专注于服务开发者群体。然而，在Windows用户界面方面，仍有很大的提升空间。与VS Code中几乎所有元素都可自定义不同，Windows的开始菜单、任务栏乃至界面的每一个细节都缺乏个性化选项，这引发了“为什么我们就不能自定义开始菜单呢？”的疑问。

关于为何缺乏自定义选项，存在两种观点。一种认为这会增加代码的复杂度，但也有人怀疑并非如此。更可能的解释是，在重写开始菜单时，为了赶上发布排期，开发团队可能做出了妥协。如果去掉左侧、顶部和右侧布局以及两行标签页等“所有花哨功能”，项目就能提前四个月交付。虽然这未必是正确的决策，但可能是推动其发生的原因之一，尤其考虑到微软如今截然不同的发布周期。

另一种观点则强调“精雕细琢的工艺”需要长期负责和稳定。如果一个组件总是频繁变动，每个版本的用户界面都在更改，就永远无法达到那种精致程度。这被视为一个“工艺水平的问题”，而非单纯的时间安排问题。如果有一个充满热情的团队或个人能真正负责某个组件，他们就能在短时间内创造出真正美妙的东西。谷歌在这方面做得很好，他们允许个人自由发展，将“酷炫玩意儿”作为副项目，然后将其整合到整个生态系统中。

对于一位独立开发者而言，能够创造出像开始菜单或任务栏这样可定制的功能，并知道会有数百万人使用，成千上万的开发者会通过JSON配置来定制每一个细微之处，这本身就是莫大的快乐。然而，史蒂夫·乔布斯式的观点则认为，提供定制选项意味着未能为用户找到最佳解决方案。但或许，本就没有标准答案，多种选项都同样正确。

尽管如此，Windows的核心理念是成为适用于各类设备的开放操作系统。随着Windows子系统（WSL）的推出，微软在Linux兼容性方面不断迈进，整个开发者友好型生态系统也日益完善，界面的设计理应体现这种开放精神。不过，开放性也可能带来安全漏洞，尤其对于Windows这样一个持续遭受攻击的系统而言，确保其安全性至关重要。

故事随后转向了戴夫·普卢默的个人经历。他讲述了自己开发VisualZIP的历程，这款软件最终演变成了我们熟知的Windows内置ZIP文件夹。当时，他为了宣泄工作中只能修bug而无法释放的创作欲，并想赚点外快。受一套挂牌出售的房子和停在车道上的“93年红色克尔维特敞篷车”的激励，他将房子的图片剪下来贴在显示器上，以此作为晚上坚持写作的动力。VisualZIP最初是一个基于MSJ示例的shell扩展程序，在他真正加入shell团队之前就开始了。他将其作为共享软件发布，在1995年左右卖出了几百到几千份。

一天，他接到一个电话，对方是“微软的贝琪”，询问他是否是VisualZip的开发者，并表示微软想谈谈收购事宜。戴夫幽默地问：“你们在哪个楼？”因为他自己就在微软工作。经过一番沟通，两人才意识到贝琪并不知道他已是微软员工，微软只是“冷不防地给作者打了个电话”。最终，戴夫接受了微软的收购条件，用这笔钱买了一辆“93年二手红色科尔维特”。

VisualZIP被收购后，许多功能被移除，以适应Windows系统。例如，加密功能被移除，因为当时加密技术被视为军需品，不能随意添加到操作系统中；多卷支持也被简化。戴夫还回顾了ZIP格式的历史：它起源于BBS时代，菲尔·卡斯特开发的PKZIP在MS-DOS时代变得无处不在。当Windows问世时，尽管ZIP格式已被使用了十年，但Windows无法直接打开，这直接推动了将ZIP支持内置到操作系统中的需求。然而，由于代码是在单核时代编写的，它缺乏多线程处理能力，导致在现代多核处理器上解压文件时效率低下。

除了ZIP支持，戴夫还参与了其他酷炫项目，包括Windows Media Center最初的原型开发工作。在1996年，资源匮乏，他们只有一张光盘，里面存着《狂暴鲁道夫》和原版《南方公园》圣诞特辑的MPEG视频。由于无法将有线电视接入大楼，他们甚至在屋顶安装了18英寸的DSS卫星天线，搭建了一个最终看起来很像Media Center的系统，这是一个可以通过遥控器操作的Windows远程观看用户界面，因为标准的开始菜单“在20英尺外看起来效果不佳”。

最后，戴夫解释了臭名昭著的“蓝屏死机”（BSOD）。当内核进入非法操作状态，例如设备驱动程序试图写入不属于它的内存区域，或重复释放同一块内存时，Windows别无选择，只能关机以防止进一步损坏，并显示蓝屏。在当前Windows系统中，有时会显示一个悲伤的表情。Windows 3就有蓝屏，但Windows NT的蓝屏有所不同。编写Windows NT蓝屏代码的约翰·维特选择蓝底白字，并非为了实验室可见性，而是因为他构建所用的MIPS固件和他的编辑器Visual SlickEdit都采用了相同的蓝底白字配色方案，这让他能在相同的视觉环境中编写代码、启动系统、看着它崩溃并重新启动。

至于为什么电脑的许多问题可以通过“关机再开机”来解决，戴夫给出了两个主要原因：一是内存泄漏，长时间运行会导致内存被占用后未被释放，数据堆积，系统运行缓慢；二是代码进入了开发者未曾预料或充分测试的状态，导致程序陷入异常。重启或关机能提供一个全新的状态，清除内存泄漏，从而“掩盖很多问题”。

# Chapter 7: 一位资深程序员的微软内外传奇：代码、调试与创业的感悟

在软件开发的世界里，系统运行迟缓是常态，这往往是由于数据在堆内存或交换文件中堆积如山所致。更棘手的是，代码有时会进入开发者未曾预料或充分测试的状态，即使这种状态极其罕见，也足以让记事本、Word或Excel等常用软件陷入异常，让整个系统显得极不可靠。面对这种“元滑稽状态”，最直接的解决办法就是重启或关机，让系统恢复到全新状态，从而消除内存泄漏，掩盖诸多潜在问题。

在微软的职业生涯中，我见证了形形色色的代码。最让我印象深刻的“漂亮代码”有两段：一是Windows内核的通用部分，其底层NT API接口编写得极其精良，达到了用户层面难以企及的标准。二是Bob Day为Windows 95编写的命名管道实现，它巧妙地避免了共享内存的使用——这在NT系统和工业级应用中是个糟糕的主意。Bob的方法令人惊叹，代码审查时我甚至觉得“要是我刻意去做可能反而做不到”。

说到最厉害的程序员，我脑海中浮现的不是某一个人，而是一个故事。刚进公司六周时，我正在研究OLE演示缓存，当时我用Windows 95系统调试Excel嵌入Word时，调度程序出了问题，导致程序死锁。我几乎没写过x86代码，面对内核调试器束手无策，于是向Windows 95内核团队求助。大约十分钟后，一位开发人员悠闲地走进来，手里只拿着一根零调制解调器线缆。她坐下来，熟练地操作着WinDbg——一个糟糕透顶的调试器，却在她手中如水银般灵动。她飞速遍历调用栈，检查内核对象，试图找出死锁的原因。这就像一场芭蕾舞在我眼前上演，我这个自认为不错的程序员，在那位调试大师面前感到相当震撼。仅仅五分钟后，她便说：“哦，我明白了。”然后起身离开。她就是后来成为微软杰出工程师的Laura Butler。她为我树立了榜样，让我见识了微软开发者，尤其是内核开发者的高标准。

我一直对那些在任何领域都做到极致的人心怀敬意，尤其是在工程领域，越是底层技术越让我着迷。那些能够运营和维护复杂计算机基础设施的人，在我看来简直是魔法师。就像观看一位技艺精湛的木匠工作，那种极致的成就感令人心潮澎湃。无论是土木工程中宏伟的桥梁，还是软件领域中Linux及其无数开源组件对亿万人的影响，都让我深感震撼。以任务管理器为例，它被使用了多少次？可能有几十亿次，每月约二十亿次。更让我着迷的是，当我在脑海中构建一个复杂的软件设计，理清所有组件的协同工作方式，最终代码完美实现了我的构想，而这个构想现在运行在数亿台机器上，被数十亿人使用，这本身就非常酷，无关虚荣，只是一种纯粹的惊叹。

这些年来，我的编程方式也发生了变化。以前我习惯于不停地写代码，直到某个时候才回头整理优化。现在，我更注重代码的严谨性和复杂度，尝试先写出非常清晰的基础框架代码，再逐步完善。因为我见过太多最终变得一团糟、无法修复的项目，深知前期投入的工作最终会带来回报。

我的主力语言一直是C++和汇编语言。虽然现在我正专注于Lua和Python，但这只是我的副业项目。我正在开发一个能玩雅达利老游戏《暴风》的AI，这款1980年的3D矢量游戏非常复杂，我甚至保持着它的世界纪录。为了实现这个目标，我首先逆向工程了游戏的ROM，了解了所有代码和内存布局。然后，我用Lua编写了一个应用程序，在游戏运行时从内存中提取所有有趣的数据，将其作为参数通过套接字发送到Python端。Python端则使用一个双重DQN（Dueling Deep-Q Network）进行强化学习训练。目前，AI已经能达到36关的水平，远超大多数人类玩家，但我的目标是打通96关，所以还有很长的路要走。至于C++，我最喜欢它能让我把钟爱的C代码封装进类里。我骨子里是个C语言程序员，虽然我写两种风格的C++代码：一种是完全不使用指针和字符数组的现代C++20，在我看来它和Rust一样安全；另一种是带有类的C语言，即标准C加上多态性和封装性。

离开微软后，我开发了许多成功的软件，其中一些甚至是在微软工作期间兼职完成的。我旗下有一家名为Software Online的公司，后来因为过度骚扰用户升级而惹上了麻烦。那段经历，除了家人健康方面的担忧，是我生命中最令人振奋和激动的时期。当时我在微软工作，私下出售我编写的共享软件工具。我发现网上有横幅广告，于是用信用卡在一个名为FastClick的网站上注册，设置了按展示付费，但没有设置上限。结果周一回来发现已经花了近1万美元，而销售额只有38美元。我当时想：“天啊，这要怎么跟我老婆解释？”但我也意识到，只要扩大规模，这门生意就能成功。接下来的几年里，我基本上都在做这件事。我们之所以陷入麻烦，是因为司法部长介入调查，他们提出了12项诉讼主张。作为一个自闭症患者，我震惊了，因为在我看来，其中10项简直荒谬至极，我无法认同。但他们只关心那两件可能属实的事情：30天试用期到期后的处理方式。

# Chapter 8: 从法律纠纷到旧物修复：一位自闭症软件开发者的反思与爱好

在接下来的几年里，我全身心投入到一项工作中，直到一场突如其来的司法部长调查将我们卷入麻烦。他们提出了12项诉讼主张，其中10项在我看来简直荒谬至极，作为一名自闭症患者，我无法理解为何要讨论那些我明明知道绝非事实的事情。他们真正关心的只有两项可能属实的主张。

第一项是关于我们软件的30天试用版。当试用期结束后，如果用户选择继续使用而不购买或卸载，软件会每天提醒一次，而不是每十分钟弹窗，但每天最多一次。总检察长认为这过于频繁，等同于垃圾信息。最终，我们同意将提醒频率限制为每周一次，并增加了一个一键卸载按钮。

第二项则与那个年代的消费者预期有关。在2001年，确切地说是2003年左右，即使人们在线购买的是数字下载版软件，他们仍然期待能收到实物光盘。因此，我们将默认设置为通过光盘交付，通常是3到4.95张额外光盘，并且这个复选框选项默认是勾选的。我们之所以这样做，是因为如果不提供光盘，就会接到大量电话，用户会等待两周后打电话询问：“我的光盘在哪？”当我们告知他们根本没有订购光盘时，他们往往会取消订单并要求退货，因为他们等不及了。然而，华盛顿州的总检察长认为这违反了“否定确认账单原则”，因为我们实际上默认提高了购买价格。

这次经历让我开始思考用户关系中的一个核心问题：多久打扰用户才算合适？如果你从不提及任何功能，用户可能永远发现不了他们真正想要的东西；但如果提及得太频繁，又会惹恼他们。你绝不希望用户为了摆脱某种提示而被迫去处理或购买什么。这让我联想到Windows操作系统，它至今仍在某种程度上困扰着我。比如，它会不断询问“你想要这个吗？”我真的不喜欢用我的微软账户登录Windows，现在这几乎成了强制要求，感觉就像他们故意让我难以按自己的意愿行事，仿佛在愚弄我。在Windows升级过程中，那个“使用推荐设置”的选项尤其让我反感。它听起来像是你应该做的，但我很确定这会让你重新使用Edge浏览器，以及其他一些我不需要的东西。这种做法可能在转化用户方面有效，但从长远来看，它损害了用户信任，最终可能导致Edge被视为一个“无法完全信任的浏览器”，尽管我认为Edge本身是一款非常优秀的浏览器。你总不希望自己的操作系统变成对手，对吧？有时，Windows给人的感觉就像是在与你作对，并非真心为你着想。我宁愿每年支付199美元购买Windows专业版，或者每月20美元，这样就不会被追加销售，我的数据也不会被货币化。

从这些经历中，我学会了如何找到平衡点，变得更加自我意识，尤其是在广告宣传方面。我一直记得大卫·奥格威为大众甲壳虫做的一则广告，画面上只有一张黑白甲壳虫的图片，上面写着“柠檬”，下面配有一段文字。这种先吸引眼球再提供信息的方式，我一直努力遵循。我认为销售产品有三种方式：利用性、恐惧或贪婪。性对软件销售效果不佳；杀毒软件用恐惧营销很有效，但对系统优化和提速工具就不太适用了。所以我过去一直专注于挖掘用户的贪婪心理，宣传“让电脑运行更快”、“释放更多可用内存”之类的价值主张。但现在我意识到，作为一名自闭症患者，我是以自己的认知来看待这件事的，而他人可能会基于自身背景知识得出不同结论。我可能无意中吓到了别人，而本意只是想激发他们的贪婪本能作为激励手段。所以如今我会对这类表达更加谨慎。

谈到Windows，我个人是Windows 2000服务器版的忠实粉丝。没错，我就是靠它经营我的生意和我兄弟的生意，我们建立了多家沙龙，全部通过VPN互联并使用SQL Server。虽然它没有XP那种视觉上的炫目效果，但作为一个系统，尤其是作为服务器操作系统，在当时它已经非常出色了。不过，从完整性、影响力以及持续时间的角度来看，Windows XP可能是最伟大的Windows系统，对于消费者来说，它确实经久不衰，甚至现在仍有人在使用。如果还能获得安全更新，我仍然会在某些设备上运行它，因为它能满足我对Windows需求的98%。我的Windows版本排名是：Windows XP第一，Windows 95第二。我的评判标准是行业影响、稳定性，以及所有功能协调得多么完美，有一种贯穿始终且保持一致的设计理念，功能不多不少，既不过分简化，也不过度复杂，蓝屏死机的频率也很低。它简洁明了，功能明确，响应迅速，没有太多粗糙的边缘感。

除了软件，我还喜欢玩老虎机。我觉得有点讽刺的是，我明明知道玩老虎机总体上是个必输的赌局，但那里有让我着迷的多巴胺盛宴，还有我喜欢的炫目灯光和高对比度色彩。但实际上，老虎机内部有一个黑箱机制，它所做的无非就是生成下一个随机数，并决定结果在概率和赔付方面的表现。然后游戏就会说：“我得编个剧情来配合这个结果。”也许是三条杠或其他什么图案，但它们之间毫无关联。这并非转动卷轴看它们停在哪里，然后查表确定你赢得了什么。完全是相反的逻辑：它判断你是否获胜，然后编造些内容来适应那个场景。这些设备本质上都是普通的Windows电脑，只不过运行在某种超安全加密飞地架构上。在70或80年代，拉斯维加斯曾有一位技术员，他四处走动，为老虎机烧录自己的ROM，这些设备里留有后门，所以当他维修机器时，他会直接把他的ROM放进去，六个月后回来，调用后门程序。

我还喜欢各种老式硬件设备。我从事汽车修复工作，经常修理20世纪60年代的美式肌肉车，包括轿车和卡车。此外，那些老式电脑也是我的心头好，我专门修复PDP-11。这大约是我过去六个月以来的痴迷和特殊兴趣所在，我已经组装了好几台这种古董机。我曾组装过好几台PDP-11，这些年来我收集了所有这些零件，于是决定：“不如我来组装一台能造出的最好的PDP-11吧。”这就像是一场追求完美的探索，我曾试图榨干一台PDP-11的全部性能，所以它配备了4兆内存，在当时算是巨量了。它有很多闪烁的灯，我还得重写BSD内核才能让这些灯正常工作。

# Chapter 9: 探索完美与理解：一位自闭症工程师的内心世界

我的旅程始于对完美的极致追求，就像是渴望榨干一台电脑的全部性能。我曾试图将一台PDP-11/70的潜力发挥到极致，它配备了在当时堪称巨量的4兆内存。那台机器，闪烁着无数灯光，为了让它们正常工作，我甚至重写了BSD内核。它的控制面板位于最顶部，下方是两个底盘，上面布满了旋钮，这些旋钮控制着LED显示屏，能实时展示数据总线和地址总线。我可以暂停机器运行，编辑总线上的地址，甚至用开关向内存中存入数据。那种触感，加上LED灯效，简直就是我心中电脑该有的样子。我还修复了一个奇特的双软驱DU-1/DU-2，它只有一个步进电机，两个磁头像连体双胞胎一样同步寻道。它现在真的能运行，那些闪烁的灯光都是真实的！为了添加新的设备驱动，我不得不重新编译内核，因此我对BSD内核变得相当熟悉。是的，我能在这台机器上运行代码。

作为一名自闭症患者，我也写过几本关于自闭症的书。自闭症患者与神经典型个体在思维方式上存在根本性差异，这被称为“单轨思维”。这意味着我的大脑一次只专注于一件事，并会非常专注地完成它，然后才能继续下一件事。我不是多任务处理者，而是一个连续的单任务执行者。自闭症通常伴随着感官敏感和重复行为，如果严重到无法调节，就会成为一种障碍。然而，自闭症生活中最大的好处是我能对特定任务付出难以置信的专注力和投入，前提是那必须是我热爱、有回报且能不断取得进展的事情。那种纯粹的快乐，就像小孩子玩火车玩具一样。有趣的是，我也深受多动症的困扰，而且还挺严重的。所以，保持专注或真正获得专注才是问题所在。我很容易分心，甚至戴着降噪耳机也能睡着，或者根本无法入睡。但一旦我进入专注状态，就很难被打扰，这有点矛盾。

自闭症思维最大的生活挑战是我不知道别人在想什么。我无法像大多数神经典型人群那样，通过观察你的表现、反应和面部表情来推测你的感受。这些对我来说完全不知所云。我为每个打交道的人都运行一个小小的“代理NPC游戏”，这让社交互动变得有点复杂。电话交流尤其困难，因为我需要依赖很多其他线索，而电话里我只能听到声音，许多隐含的信息都无法捕捉。因此，我在FaceTime上表现要好得多，因为能看到对方的表情。在电话里，我分不清你是在讽刺还是认真的，这给我惹了不少麻烦，甚至和我的妻子之间也经常如此。自闭症中确实存在某种字面化的思维方式。多年来，每当她说什么，我就会说：“但这说不通啊。”她会说：“你懂我意思吧。”我则会回：“不，我清楚你说了什么，而且我并不是在故意抬杠。”我确实只知道你所说的内容。我记得有次会议，我是唯一的自闭症患者，我不得不指出他们形成了某种沟通循环，然后说：“你们得告诉我发生了什么，因为我真的听不懂这里在说什么。”

这让我想起早期与比尔·盖茨的一次略显尴尬的相遇。那是我在微软实习的第一个夏天，比尔邀请了大约20到25名实习生去他家吃汉堡喝啤酒。当时我的经理本是我的导师，他把我介绍给比尔，并自豪地列举了我的成就，说我在短短四个月内完成了某个功能以及Disc Copy和Smart Drive。但我停了下来，打断他们说：“其实准确来说是三个月。”他们俩对视了一眼，我意识到那不是个合适的时机去纠正。现在我比以前好多了，更清楚毫无意义地在对话中插入纠正会如何影响对方。

对于拥有自闭症思维的人，我有什么建议能帮助他们在世界上蓬勃发展呢？在繁荣和财务方面，最重要的一点是：推销你能做的事，而不是你自己。如果你能带着作品集去展示你的GitHub贡献、参与过的项目和实际编写的算法，我认为这样会让你走得更远。然而，在大型团队中进行软件工程很大程度上具有社交属性，这曾是我的一个弱点。当我开始管理人的时候，这是我最大的不足，因为我需要关心他们的希望、梦想和抱负。我总以为他们和我一样渴望被激励、被领导、被鼓励并获得回报，但事实并非总是如此。有些人需要更多肯定，有些人只想要钱，还有些人则渴望参与重要会议并拥有决策权。我当时对此几乎毫无察觉，最终才明白每个人都有自己的一套动机和优先事项。现在，我开始直接询问他们关心的是什么，因为我不擅长那种社交舞蹈，那种包含许多未言明信息的沟通方式。讽刺、挖苦和幽默对我来说也比较难把握。

我还想分享一个10秒钟的自闭症测试。当然，任何只有两个选项的测试都会有很高的误差率。第一个问题是：对整个人类社会而言，什么才是最重要的品质？是合作还是创造力？大多数神经典型人群通常会倾向于选择合作，而自闭谱系人群则往往更倾向于将创造力视为独立解决问题的能力。如果你想将精确度提高一倍，可以使用第二个测试方法：房间里放着10把椅子，有六个人进来坐下了。还剩下多少把椅子？现在有人会说“四把”，但我要说“十把”，因为椅子总数还是那么多。我并非故意刁难，也不是要搞复杂化，但这就是我的思维方式。对我来说，一切都很字面化。我记得小时候，祖父在厨房里为妈妈搭建一个花盆架，他用了些大角铁支架，我说：“你觉得这个够大能放下那株植物吗？”他说：“这都能装下一匹马了。”那时我才五岁，但实在想不明白为什么有人会把马牵进厨房，为什么要把马放在花盆上。这对我来说完全说不通，显然这是个比喻说法，但在我的大半生里，我都把比喻当成字面意思来理解。

为了更好地理解普通人的世界，我采用了一种策略，叫做“情感后处理”。当我遇到某人，尤其是初次见面或刚开始打交道时，比如今天和你见面后，我回家后会重新回想所有需要做选择的时刻。通常会先回想最尴尬的场景，找出自己当时哪里做得不对，我错过了什么，对方当时是怎么想的，下次遇到这种情况我该如何改进，甚至是否需要去补救或打个电话。这种方法帮助我逆向推演出社交互动的规律。

# Chapter 10: 自我审视、人际探索与编程之旅：一位自闭症患者的内心独白

故事的主人公，一位自闭症谱系人士，有着独特的自我反思习惯。每当他与人，尤其是初次见面或刚开始打交道后，回到家都会重新回想所有需要做选择的时刻。他会优先回顾那些最尴尬的场景，试图找出自己哪里做得不对，错过了什么，对方当时可能在想些什么，以及下次如何改进。在极端情况下，他甚至会考虑是否需要去补救或打个电话，以弥补那些糟糕的局面。

他分享了一个深刻的经历：他父亲在1969年购买的一辆新车，他至今仍保留着，算起来已经拥有了50年。大约20年前，他决定对这辆车进行彻底翻新，整个修复过程持续了三年，工匠们投入了数千小时的精心工作。当他去取车时，他仔细检查了修复工作，非常满意，不停地赞叹“这真不错，太棒了”。然后他飞回家开了支票，车就被送来了。然而，直到大约十年后，他才意识到，他有一群工匠为他的车工作了整整三年，或许他本应该对他们大加赞赏，说他们干得多么出色，但他当时并未意识到这一点，因为那并非他当时所需所求。于是，他给经理或店主发了一封邮件，坦诚地写道：“不知道您是否还记得，但十年前我来取车时，可能表现得不太满意，但我想让您知道，其实我对所有细节、品质等都非常认可。”对方回信说：“我经常想起那一刻。”这让他感到欣慰，因为他终于弥补了那份迟到的赞扬。

这个故事引出了一个更广泛的观察：人类互动中存在一些微妙的细节，对人们意义重大，但如果直接询问，他们可能无法表达出来。当这些微妙之处缺失时，人们会感到困扰，但对于一个可能察觉不到这些细节的人来说，要逆向分析、找出原因则非常困难。

关于同理心，他认为社区中“自闭症患者缺乏同理心”的看法是错误的。他强调自己相当感同身受，但问题出在沟通上，而且是双向的。他无法知道别人的感受，因此在对方向他传达经历之前，他很难产生共情。一旦他了解了对方内心的想法，他就能深感同情。他给那些与自闭症人士打交道的人的建议是：要非常具体，不要假设他能领会那些细微的暗示和潜台词。如果想引导他采取某种特定行为，最好直接说：“戴夫，你需要这样做。”他甚至会主动询问：“我今天有哪里做得不够好吗？”他给自己在沟通方面的表现打分，从六分、七分到五点几分，这显示了他对自我评估的严谨。

他进一步解释了“伪装行为”——这对于许多自闭症谱系人士来说是一种重要体验。伪装本质上就是表现得像常人一样，在社交场合中努力模仿神经典型人群的行为方式，以确保被正确地接收和接受。从挥手、做面部表情，到说话的语调和姿态，所有社交互动都需要精心设计和付出努力。对大多数人来说，这些是自然而然的，但对自闭症谱系的人来说，却需要全程假装。他引用了Rush乐队的歌曲《聚光灯》，猜测歌词作者尼尔·佩尔特可能也属于自闭症谱系，因为歌中描述了在“世界舞台”上挣扎着扮演角色，无法将陌生人当朋友对待，强装出一副样子的感受。

谈到“崩溃”，他将其描述为一种难以承受的经历，通常是情绪上不堪重负，以至于无法再控制自己的行为。就像电影《雨人》中试图登机被阻拦时的失控，或者某部自闭症医生电视剧中主角因自闭症被禁止手术而彻底崩溃的场景。他解释说，这就像存在一个临界点，一旦越过，开关就会切换，大脑会进入“蓝屏”状态，前额皮质关闭，失去决策和过滤能力，进入原始脑模式。这实际上是一种恐慌状态，一种战斗或逃跑反应，源于无法忍受当前的现实，可能是长期沮丧、混乱、糟糕的旅行日或工作争吵累积到极致的触发。

在爱情和人际关系方面，他坦言挑战重重，尤其是对事物的字面理解，让恋爱关系的复杂性更加明显。他与妻子结婚31年，在一起37年，他们的关系历史悠久。他们第一次意识到彼此的巨大差异，是在一个夜晚，他们坐在车里，他看着街对面一栋房子周围用锚链连接的巨大砖柱围栏，心里琢磨着：“它们是空心的还是后面填了东西？是灌了混凝土还是别的什么？”而他的妻子却困惑地看着他，不明白他为何会关心这种事。那一刻，他们都明白了彼此思维方式的截然不同。他承认自己向来不擅长与人相处，总是无法理解别人为何喜欢他。他的儿子也继承了这一点，他甚至给儿子买了件T恤，上面写着：“如果你想追我，请明确告诉我，因为我完全不懂暗示。”对他而言，他不得不通过长时间的相处，慢慢赢得人们的喜爱，因为他缺乏社交技巧，无法参与那些社交场合所需的“舞蹈”，所以唯一的选择就是做真实的自己。他提到，妻子的家人在表达“我爱你”方面比他家人开放得多，这对他来说是一个成长阶段，现在已不再是问题。现在，他们之间形成了一种默契的确认机制：妻子会突然问“你还好吗？”，如果他回答“嗯”，就表示一切正常；如果他回答“嗯……”，妻子就能察觉到不对劲。这种明确的检查机制，弥补了无法通过观察读懂彼此心思的不足。

他还提到了“有点自闭症倾向”的概念。他认为大约10%到20%的人口在某种程度上属于自闭症谱系，但受影响程度尚未达到障碍的标准。他们仍具有许多源于自闭症的特征。如果他们能够理解、识别并管理这些行为，就能既利用这些特征发挥某些技能优势，又能调解随之而来的缺陷和问题。他为自己的孩子们写了一本书，作为小指南，因为他们虽然没有被诊断为自闭症谱系障碍，但某些行为特征与他特别相似。

最后，他解释了为何许多优秀的程序员和工程师都属于自闭症谱系：那种一心一意的专注力、将问题简化的能力，以及对事物本质永无止境的好奇心。他从小就对“里面有什么”充满执念，甚至拆开妈妈的烤箱只为弄清翻转时钟的工作原理。他认为，这种愿意甚至兴奋地深入了解细节的特质，是成为一名程序员的良好习惯。目前，他正忙于一个酷炫的编程项目：让强化学习算法学会玩《暴风》游戏。项目已接近成功，95%的工作已经完成，主要是在调整模型大小和层数等参数，以突破学习阈值。他的目标是让这个算法能够打败他。

# Chapter 11: 一位技术先驱的编程之旅与未来洞察

故事开始于一个令人振奋的时刻。一位技术专家正投入到一个雄心勃勃的AI项目中，他透露项目已“胜利在望”，距离成功“非常接近”。目前，团队正专注于调整模型的规模和层数等参数，以期突破学习的阈值。尽管涉及数千行Lua和Python代码的复杂协作，但系统运行良好，95%的工作已经完成。现在，主要任务是微调超参数，并祈祷能达到最佳效果。他认为这在某种意义上已是成功，但真正的挑战在于，这个AI究竟能走多远？他的终极目标是让AI能够打败他，尽管他承认这确实是个艰巨的挑战，因为目前AI在许多游戏中的表现已超越人类，但可能尚未达到如此复杂游戏的水平。

除了AI项目，这位专家还在研究一些“很酷”的硬件。他正尝试获取一个名为RA82的PDP-11驱动器——一个14英寸的庞然大物，转速高达每分钟3600转，运行时听起来像一台洗衣机。他的计划是找到配套的控制器卡，编写代码，将其集成到驱动程序中，并最终让整个系统正常运行，包括将驱动堆栈集成到内核中。

随后，对话转向了一个名为“GitHub Primes”的史诗级项目。他最近组装了一台内存高达1TB的机器，正是为了运行这个项目。GitHub Primes是一个素数算法的集合，用大约100种不同的编程语言实现。这些算法完全相同，但参与者必须遵守特定规则以确保公平性，然后用他们选择的语言尽力表达这个算法。项目每晚进行基准测试，汇总结果以找出运行最快的语言。所有语言都被构建到独立的Docker容器中运行，旨在比较不同编程语言的性能表现。

当被问及哪些语言通常会胜出时，他指出目前是Zig。不过，情况是动态变化的，C++的改进者会努力提升，然后Zig的支持者又会卷土重来，使其更快。目前，性能排序大致是Zig、Rust、C++、C。他们测量性能的方式是在一个五秒的循环内，尽可能多次地求解一亿以内的质数，所有核心和CPU都参与其中，一遍又一遍地重复。

关于代码的编写方式，虽然允许自由实现，但必须是素数筛算法，并且每个整数最多只能使用一个比特位，这意味着不能使用更简单、更便宜的字节。此外，还有一系列规则要求在定时循环内分配内存。当然，也有一些不遵循这些规则的“展示项目”，比如针对只有64K内存的6502处理器，因为它无法完成一亿次的筛选。但在主要语言中，它们都遵循相同的规则，因此性能差异主要取决于算法在该语言中的表达方式，以及语言本身的限制或优势。每种语言都允许多次提交，例如C语言就有大约五个版本，有些甚至使用了不同的编译器，如GCC、Clang和LLVM。他提到几年前的快照数据显示，Zig位居榜首，其次是Rust、Nim和Haskell，而C的运行时间是Zig的五倍。这个项目甚至包含了像PowerShell这样“疯狂”的语言版本。整个流程是自动化的，提交操作的处理也很有结构。最初，他只支持Python、C#和C++三种语言，但随着人们提交更多解决方案，项目规模迅速扩大，最终不得不由欧洲的Rucker和Tudor两位专家接手管理。

谈到编程和构建项目中最快乐的时刻，他表示最享受的是当他构建了一个复杂的东西，并且它确实按照他预想的方式运行时，那种极大的满足感。虽然很少能一次成功，但当结果如计划般呈现并成功运行时，那种感觉无与伦比。对于C++这样的编译型语言，当一大堆代码编译通过，没有任何警告和错误时，那种感觉也“很棒”。

展望编程的未来，他谈到了具备代码生成能力的LLMs。他承认自己对Python不太擅长，算是刚入门，但在使用Cursor这类工具时发现它们非常有用。通过观察AI生成的代码，他学到了很多，尤其是当他不知道如何实现某些功能时。他发现，如果让他从零开始写Python代码，长度大概是AI生成代码的四倍，因为精通Python的人可以写得很简洁。他认为，对于像他这样优秀的C++程序员来说，这是一种快速掌握新语言的绝佳方式，可以“凭感觉摸索着写代码”，通过生成代码来学习新的解决问题思路。他强调，虽然AI能生成代码，但你仍然需要学会编程，能够读懂代码，并知道接下来该让AI做什么。他认为，如果是一个完全没编过程序的新手，光靠感觉是写不出代码的，但对于优秀的程序员，AI能让他们变得无比强大。

对于未来5年、10年乃至20年编程的发展，他认为“氛围编程”目前更像是一个有趣的梗，因为那些不懂编程却只搞氛围编程的人，几乎都在开发无法投入生产环境的系统。他强调，开发一个产品确实很难。他认为，优秀的程序员基本上能凭直觉写出符合需求的代码，AI不过是一个“花哨的自动补全功能”，最终仍需手动编辑，或是学习新API、新语言的一种方式。但他同意，随着AI变得越来越智能，我们不知道上限在哪里，这可能会改变程序员这一职业的本质。他将未来的编程比作建筑师建造桥梁：过去工人需要在现场焊接钢梁，而现在只需在AutoCAD中拖拽元素，用预制的大型构件进行组装。他认为编程也会变成这样，不再需要逐行编写代码，而是通过移动组件和界面，向AI描述交互方式，然后让AI来构建这些组件。但他认为，距离AI能完全自主生成，比如直接说“给我一个与Linux兼容的Linux内核”并高效实现，还有相当长的路要走。

当被问及这种快速攀升的抽象层级是否让他感到失落时，作为一个曾经编写机器码和汇编语言，然后经历C和C++，现在又达到自然语言直觉编码阶段的人，他表示自己赶上了特别幸运的时代。他经历了30到40年技术发展的全过程，既懂TTL逻辑电路，也能用AI编写代码，并且大致了解中间的各个环节。他认为，要获得这种程度的知识或完整的图景，唯一的方法就是长期沉浸其中，而对于现在刚开始的人来说，复制这种经验将会很困难。

最后，关于生命的意义，他认为就是“创造很酷的东西”。从根本上说，他关心的是能够创造出对他人有用的复杂事物。他提到《沉浸式翻译》充分发挥了他的能力，让他能够以创造性的方式开发出可供他人使用的工具，这种创作自由度是传统艺术形式难以企及的。对他来说，这就是生命真正的意义，也许还能培养几个优秀的孩子来传递接力棒。他一生创造了不少很酷的东西，影响了数百万人，甚至可能是数十亿人，如今还在通过YouTube上的精彩内容激励着更多人。

对话在主持人对他的感谢和赞美中结束，主持人表示自己是他的超级粉丝，并引用了C++之父比雅尼·斯特劳斯特鲁普的名言：“世界上只有两种语言：一种是被人抱怨的，另一种是没人使用的。”以此作为播客的结束语。

