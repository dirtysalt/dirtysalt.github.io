# Chapter 1: 亚美尼亚血脉与创业精神：Avi Tavanian的童年岁月

1961年，在美国东海岸的缅因州波特兰市，一个名叫Avi Tavanian的男孩呱呱坠地。多年后，在2月21日的一次口述历史访谈中，Avi向John Maroff、Sue和David Brock讲述了他的非凡人生起点。

Avi的家族血脉百分之百源自亚美尼亚。他的父母和祖父母都是亚美尼亚人。二十世纪初，他的祖父母为了躲避与土耳其人的战火，乘坐轮船漂洋过海，来到了美国。父亲的家族在缅因州波特兰安家，而母亲的家族则定居在马萨诸塞州的伍斯特。命运的丝线将他们牵引，Avi的父母相遇、相爱并结为连理，Avi便是他们四个儿子中的长子。

在Avi成长的家庭中，亚美尼亚语偶尔会在父母之间响起，通常是当他们不希望孩子们听懂谈话内容时。尽管孩子们只掌握了零星的词汇，不足以流利对话，但他们总能猜出父母话语的大意。

Avi的母亲在婚前曾是一名簿记员，婚后便全身心投入家庭，成为一位全职母亲，悉心照料着四个活泼的儿子。而他的父亲，则是一位白手起家、充满传奇色彩的创业者。父亲的童年异常贫困，十岁出头便开始在波特兰的码头打工。凌晨三四点，当渔船靠岸时，他便去购买新鲜的渔获，再转手卖给超市，以此赚取微薄的收入。他还送报纸，只要能赚钱，他什么都做，同时坚持上学。二战期间，父亲应征入伍，成为一名机械师，在战场后方修理坦克等重型装备，亲身经历了战争的洗礼。退役后，他先是在机械车间工作，甚至在一家圣诞饰品工厂待过一段时间。直到五十年代末，父亲的创业天赋开始显现。他敏锐地捕捉到汽车影院的兴起，于是在波特兰郊外购置土地，建造了一家汽车影院，至今仍是家族经营的产业。六十年代，父亲又以破产价收购了一家保龄球馆，并成功将其扭亏为盈。Avi本人也曾在这家保龄球馆度过无数个工作时光。随着弟弟们长大成人，父亲又在保龄球馆旁开办了一家零售船只生意，后来逐渐扩展到雪地摩托、摩托车等“有趣玩具”的销售，如今这部分业务仍由Avi的两位弟弟经营着。父亲的创业基因令人惊叹，他从一名蓝领工人起步，却拥有超越常人的商业头脑和远见。他不仅努力工作以维持生计，更渴望通过冒险和创新来改善家庭生活。Avi回忆道，父亲甚至在他年幼时就教他股票市场的运作原理，这在当时是相当超前的观念。

Avi的家庭生活充满了活力。四个男孩的家庭，用Avi的话来说，是“有点疯狂”。母亲是位出色的厨师，餐桌上总少不了传统的亚美尼亚美食。父亲则是一位勤劳的榜样，每天早出晚归。兄弟们之间感情深厚，常常一起玩耍。他们居住的社区友善开放，家家户户的门都不上锁。孩子们在街上玩踢球，在田野里打棒球，那是六七十年代典型的美国郊区童年。晚上，一家人围坐在唯一的电视机前，有时吃着电视晚餐，Avi正是在那时成为了《星际迷航》的忠实粉丝。

然而，Avi从小就与众不同。当他的弟弟们纷纷投身家族的实体生意时，Avi却展现出对数学的非凡天赋。父亲常常在一家人乘坐旅行车出行时，在车里大声出题，让年幼的Avi解答乘法表等数学问题。他在学校成绩优异，作业对他来说轻而易举，而对弟弟们则更具挑战。因此，家人很早就心照不宣地认为，Avi将来会走上一条与众不同的道路。他不仅拥有这份天赋，更对数学怀有深深的热爱。

在宗教和政治方面，Avi的家庭则显得较为随意。母亲虽然来自马萨诸塞州，曾是虔诚的教徒，但在四个儿子的“磨损”下，她的宗教信仰仅限于在圣诞节或复活节时尝试让孩子们去教堂。政治氛围也很淡薄，父亲作为商人，倾向于共和党，曾尝试竞选市议员，但因缺乏经验而未能成功，此后便再未涉足政坛。

Avi的童年大部分时光在韦斯特布鲁克度过，这是一个距离波特兰仅四英里的郊区小镇。在那里，他和兄弟们过着充满冒险的生活。他们骑着越野摩托车，在泥土小径上飞驰，甚至敢于挑战巨大的跳跃，回想起来都觉得能幸存下来实属幸运。他们还亲手建造船只，第一艘用胶合板和玻璃纤维制成的船，时速可达70英里，有一次Avi甚至看到船底的玻璃纤维开始剥落，他们才赶紧返航。第二艘船则是一艘从加利福尼亚邮购的玻璃纤维船体，时速可达90到100英里。这些独特的经历，让Avi接触到了许多学术型人才通常不会体验到的事物。

在韦斯特布鲁克的学校里，Avi接受了扎实的科学和数学教育。尽管是“半乡村”地区，但学校系统良好，师资优良。学校的课程设置相对简单，只有一个主干道和少数荣誉课程。Avi认为自己获得了很好的科学和数学启蒙。更幸运的是，在他八年级准备升入高中时，学校注意到了他的数学天赋，并对他进行了特别培养。在高中入学指导会上，学校向他展示了一台PDP-8e电脑。当时，Avi甚至不知道电脑或计算器是什么，但当他看到这台闪烁着灯光的机器时，立刻被它深深吸引，心想：“高中生活一定会非常酷！”事实也确实如此。他连续三年（十年级、十一年级、十二年级）都跟着同一位数学老师——斯莫尔先生学习，并在他的高级荣誉数学班中表现出色。放学后，Avi还会和同学们一起进行PDP电脑编程，进一步探索这个迷人的新世界。

# Chapter 2: 从闪烁的灯光到旋转的地球：Avi的计算机启蒙与大学抉择

Avi Tavanian的计算机之旅始于一个充满好奇的八年级。那是在高中入学介绍会上，他被校方特别召见，并被告知：“我们有一台电脑。”彼时，Avi对“电脑”这个词一无所知，甚至连计算器都没概念。然而，当他看到那台PDP-8e——一个闪烁着灯光的神秘盒子时，他立刻被深深吸引，心中涌起一股兴奋：“高中生活一定会非常酷！”事实证明，他的预感没错。

高中三年，Avi有幸遇到了他的数学老师斯莫尔先生。斯莫尔先生不仅教授高级荣誉数学课程，还在课余时间为学生们提供丰富的拓展活动。Avi和少数同学经常在放学后使用PDP-8e进行编程，沉浸在代码的世界里。除了常见的BASIC语言，Avi还自学了FOCAL，甚至掌握了通过前面板开关直接输入机器码的“硬核”编程方式——逐位拨动开关来设定地址和数据，这让他感到无比兴奋和满足。斯莫尔先生无疑是Avi的良师益友，他不仅是数学队的赞助人，还鼓励Avi担任队长，并在课外给予他诸多指导。

起初，由于数学天赋出众，职业顾问曾建议Avi成为一名统计学家。然而，到了高中高年级，一台全新的Data General计算机的到来彻底改变了他的职业设想。这台拥有内存、能存储程序、支持更高级BASIC语言的机器，让Avi得以编写出真正的游戏。当他看到技术人员安装调试这台新设备时，他心中豁然开朗：“这就是我未来的工作！”

尽管计算机占据了他大部分的兴趣，Avi在高中时期也并非完全是“书呆子”。他在初中时是校内体育活动的积极参与者，甚至因此获奖。到了高中，虽然体格不够强壮，无法在主流运动中脱颖而出，但他凭借家族拥有的保龄球馆，成为了一名出色的保龄球手。此外，每年夏天在湖边的度假屋，他还是个水上滑雪高手，并享受骑越野摩托车带来的运动乐趣。与父亲的机械师背景不同，Avi对机械制造没有天赋，那是他哥哥们的领域——他们甚至能从零开始组装一台雪佛兰发动机。

高中期间，Avi在自家保龄球馆帮忙，度过了许多周末和繁忙的夜晚。毕业后，他获得了第一份正式工作，在当地的SD Warren造纸厂担任“外勤组”成员，负责清扫停车场、倒垃圾，甚至清理堵塞的下水道。这份辛苦的经历让他对工厂运作有了初步了解。一年后，大学一年级结束后，他再次回到造纸厂，但这次是在研究部门，负责编程控制实验性的涂布机和蒸煮器，这让他有机会将计算机知识应用于实际工业控制，感到非常兴奋。

在选择大学时，Avi的经历颇具戏剧性。他的父母都没有上过大学，对高等教育知之甚少，而Avi自己也只是享受着高中生活，没有长远的规划。直到高四秋季，他才意识到需要申请大学。凭借获得的“博世与伦布科学奖”，他获得了一次免费申请罗切斯特大学的机会。然而，他误以为罗切斯特大学就是罗切斯特理工学院，只是为了省下50美元的申请费。他同时申请了普林斯顿、麻省理工、塔夫茨和罗切斯特。普林斯顿和麻省理工都拒绝了他（麻省理工甚至因为他的糟糕作文）。

最终，塔夫茨和罗切斯特都向他伸出了橄榄枝。起初，他倾向于离家较近的塔夫茨。但在一位家庭朋友的建议下，他和父亲第一次乘坐飞机前往罗切斯特大学参观。尽管学校告知他们没有专门的计算机科学项目，但他们将Avi带到了研究生实验室。在那里，Avi看到了让他永生难忘的一幕：一台Xerox Alto计算机，屏幕上显示着一个旋转的彩色地球。与他熟悉的PDP-8e的简陋界面相比，这简直是天壤之别。当研究生们表示他也有机会使用这些设备时，Avi立刻做出了决定：“我必须来这里！”就这样，在1979年，Avi进入了罗切斯特大学，开启了他的计算机求学之路，而这一切，都源于一个美丽的误会和一次震撼的视觉体验。

# Chapter 3: 罗切斯特的洗礼：代码与游戏的狂热

1979年，年轻的Avi Tavanian怀揣着对计算机的憧憬，踏入了罗切斯特大学的校门。他本以为自己申请的是RIT，却阴差阳错地来到了这里，但命运的安排往往充满惊喜。罗切斯特大学，因施乐公司（Xerox）的大力支持，拥有当时稀有且相对成熟的Xerox Alto计算机，这正是Avi此前在参观时一见倾心的图形界面机器。

然而，大学生活伊始并非一帆风顺。Avi第一次离家，住进宿舍，感到前所未有的孤立。那时没有互联网可以随时与家人朋友联系，也没有无限流量的手机套餐。宿舍里只有一部公用电话，昂贵的长途费用让他望而却步。更让他感到不适的是，在新生见面会上，来自纽约的同学们纷纷好奇地问他：“你那奇怪的口音是怎么回事？”他这才意识到自己带着浓重的波士顿口音，这让他感到有些尴尬和不知所措。

尽管罗切斯特大学当时并未设立计算机科学本科专业，但其计算设施在当时已属一流，并提供了一些计算机课程。Avi毫不犹豫地在第一个学期就选修了编程入门课，学习Pascal或Fortran。他很快获得了IBM 3070大型机的账户，开始了他的编程之旅。然而，大学分配给每位学生每学期100美元的计算机使用额度，Avi却在短短两周内就消耗殆尽。他不仅完成了课程作业，更沉迷于编写自己的程序，进行各种实验。其中一个让他引以为傲的早期作品，是一个能打印巨幅海报的程序。他亲自设计字体，编码实现，只为在宿舍走廊上贴上自己制作的海报。这虽然让他因为过度使用打印资源和耗尽额度而惹上了麻烦，但却也因此获得了意想不到的转机。

当Avi忐忑不安地向教授解释自己为何提前用光了计算机时间时，教授非但没有责备，反而看出了他对计算机的巨大热情。教授不仅解决了他的计算机时间问题，更将他引荐到研究生计算机实验室。从此，Avi的大学生活彻底被计算机占据。他开始为计算机科学系的教职员工工作，与研究生们并肩作战，甚至获得了报酬。在夜晚和周末，他穿梭于实验室，有时完成教授布置的任务，有时则自学Alto编程，或是在VAX系统上进行VLSI设计检查等工作。他沉浸在各种不同的计算机系统中，如鱼得水。

尽管Avi在数学方面依然表现出色，轻松应对各种挑战，但他对数学的热情却逐渐被计算机所取代。随着数学课程变得越来越抽象和复杂，他更多地是为了取得好成绩而学习，而非真正深入探索。他甚至尝试过化学和物理等高级课程，但当物理课的难度达到需要他尚未学习的微积分知识时，他便决定将全部精力投入到计算机领域。他选修了编译器理论等课程，学习如何构建编译器，但真正让他着迷的，是与教职员工一起参与实际的研究项目，以及自己动手创造的乐趣。

Avi开始在Alto上编写游戏，他并非原创型选手，而是擅长“山寨”经典。他首先模仿了《导弹指挥官》（Missile Command），这款游戏的图形相对简单，所需的微代码不多。随后，他挑战了《防御者》（Defender），这款游戏对图形处理要求极高，他不得不将大部分代码用微代码编写。他主要使用微代码和BCPL进行编程，而Smalltalk这种更抽象的语言则被他认为对游戏开发无用。Alto的图形界面让他着迷，但更让他兴奋的是能够直接操作硬件，编写微代码，甚至因为代码错误而导致计算机崩溃的风险，这种“贴近硬件”的编程哲学深深吸引了他。

Alto计算机之间是联网的，Avi也因此接触到了Rick Rashid和Gene Ball开发的网络游戏《Trek》，这款游戏极大地启发了他。Rick Rashid曾是罗切斯特大学的研究生，在Avi入学前已前往卡内基梅隆大学任教。Avi虽然没有直接接触过操作系统，因为他更专注于低级软件开发，他的游戏程序启动后会完全接管计算机，不使用任何操作系统提供的UI元素。除了《Trek》，他还非常喜欢Clint Parker开发的《弹珠台》（Pinball）游戏，这些都成为了他编程的动力。

在研究生实验室之前，Avi也曾在本科生实验室里度过了一段时光，那里有Commodore PET和Apple II等个人电脑。他会在课余时间做一些“傻事”，比如编写一个程序，让八台电脑同时运行，每台电脑演奏不同的声部，共同奏响一曲。这正是他“经典黑客行为”的体现——不断挑战机器的极限，思考如何让它们做从未做过的事情。大学期间，Avi的全部业余时间都投入到了计算机世界中，尽管那时回家就能“断网”，但在实验室里，他常常一待就是好几个小时。

在罗切斯特大学，Avi也遇到了一些对他影响深远的人。他注意到许多计算机科学家都身材高大，这让他觉得很有趣。Clint Parker虽然不活跃，但他开发的《弹珠台》游戏和一些低级Alto代码（如超高速乘除法）给了Avi很多启发，他甚至在自己的游戏中借鉴了Clint的一些代码。Rick Rashid和Gene Ball的《Trek》游戏也激发了他的创作热情。此外，他为一位VLSI设计教授工作，编写了一个前所未有的设计规则检查程序，这些经历都为他未来的计算机生涯奠定了坚实的基础。

# Chapter 4: 罗切斯特的编程飞跃：从游戏到VLSI研究，再到CMU的召唤

Avi在罗切斯特大学的时光，远不止于简单的学习，更是一场深入计算机世界的探险。他不仅在课堂上汲取知识，更在实践中磨砺技艺，甚至在不经意间，为Alto计算机平台留下了自己的印记。他曾巧妙地借鉴了Rick和Gene为Alto编写的超高速乘除法代码，将其融入自己的游戏中，让画面运行得更加流畅。Rick和Gene在“track”项目上的工作也深深启发了他，尽管素未谋面，但他们的技术精神却通过代码传递给了Avi。

除了个人项目，Avi与教职员工的关系也日益密切。他为一位VLSI（超大规模集成电路）设计教授工作，当时VLSI的设计工具还非常原始。教授雇佣他编写一个前所未有的“设计规则检查器”程序，确保电路在实际制造前就能避免短路等问题，这无疑是一项极具挑战性的任务。他还与Chris Brown教授合作，在计算机视觉的早期阶段进行探索，甚至需要亲手设计边缘检测算法——这在今天看来已是基础，但在当时却是尖端研究。

Avi对游戏的热情也从未减退。他的《Defender》游戏在Alto上运行，面临着独特的图形挑战：需要在屏幕底部实时绘制出蜿蜒曲折、由数千个点组成的随机地形。虽然Bit-blit技术在当时已是图形加速利器，但对于这种实时地形绘制却无能为力。Avi不得不亲手编写汇编指令，以每秒60次的速度擦除并重绘地形，力求与显示器同步，这无疑是对他低级编程能力的极致考验。他的游戏，如《Missile Command》和《Defender》，在Alto社区中广受欢迎，甚至传播到了其他Alto站点，为他赢得了不小的声誉，尽管他当时并未意识到这一点。

在学术方面，虽然罗切斯特大学本科生普遍学习Pascal，但Avi并未止步于此。他积极选修高级语言课程，学习了多种编程语言，甚至在一次作业中用SNOBOL语言编写了一个命令行文本编辑器，展现了他对不同编程范式的驾驭能力。最终，他以数学学士学位毕业，而非应用数学。

大学生涯的后期，Avi的人生轨迹迎来了一个重要的转折点。起初，他计划毕业后去微软找一份高薪的软件开发工作。然而，系主任Jerry Feldman教授（后来他才想起他的名字是Jerry Feldman）和其他教职员工看到了Avi在研究方面的巨大潜力，鼓励他考虑读研究生。这让Avi感到意外，因为他从未想过读研，能顺利完成大学学业已是家族中的第一人，令他倍感自豪。

正是他在VLSI设计规则检查器项目上的工作，成为了他申请研究生的敲门砖。他用C语言开发了一个动态的“标记-清除”垃圾回收器，能够自动管理数据结构，而无需手动编写内存管理代码。这项技术在当时对于一个本科生来说是相当新颖和复杂的，他甚至为此撰写了一篇论文（尽管未公开发表）。这项非同寻常的本科研究，让教职员工更加确信他适合走学术道路。

在教授们的建议下，Avi决定尝试申请研究生院，但他给自己设定了高标准：只申请卡内基梅隆大学（CMU）、斯坦福大学或麻省理工学院（MIT）这三所顶尖学府。Jerry Feldman教授亲自为他撰写了推荐信，加上他那篇独特的本科研究论文，结果令人惊喜——他被这三所大学全部录取了！

面对三所名校的橄榄枝，Avi的抉择方式颇具个性。CMU在录取信中热情邀请他参观校园，并承诺安排会面、承担所有费用。Avi欣然前往，并立刻爱上了那里。而当他联系MIT时，对方却表示不提供此类接待，这让Avi觉得仿佛是自己反过来拒绝了曾经拒绝过他的MIT。斯坦福大学虽然表示可以接待，但拒绝支付机票和住宿费，这让Avi觉得不值得。最终，CMU的真诚和热情打动了他，尽管他的缅因州亲戚们更熟悉斯坦福和MIT的名声，甚至对放弃MIT感到不解，但Avi坚信自己的选择。他爱上了CMU，就像当年爱上罗切斯特一样，那里有着同样热情友好的氛围和卓越的学术项目。

除了计算，Avi的大学生活也并非完全枯燥。虽然他回忆不起太多“有趣”的社交活动，但每到夏天，他都会回到湖边的避暑小屋，与兄弟们一起滑水、划船、骑越野摩托车。那时的计算工作是朝九晚五，下班后便能完全抽离，享受生活。在罗切斯特期间，他住过宿舍、校外公寓和校内套房。直到1984年进入CMU后，他才购买了第一台个人电脑——一台Macintosh，为此支付了2400美元（享受学生折扣），这在当时是一笔不小的开销。尽管IBM PC在他本科期间问世，但他从未对其产生兴趣，因为他觉得在VAX和Alto上编程远比在IBM PC上有趣得多。

当Avi踏入卡内基梅隆大学的校门时，他感觉自己就像一个置身糖果店的孩子。这里拥有他梦寐以求的一切：Alto计算机、他不太在意的IBM机器、性能卓越的DEC 20，以及随处可见的Perk工作站。一个全新的计算世界正向他敞开大门。

# Chapter 5: 卡内基梅隆的乐园与Mach的启程

踏入卡内基梅隆大学的校门，Avi Tavanian仿佛置身于一个科技的糖果店。与本科时的罗切斯特大学截然不同，这里的一切都让他眼花缭乱。实验室里不仅有施乐Alto工作站，还有IBM的机器（虽然Avi对此兴趣寥寥），以及当时炙手可热的DEC 20——一台性能卓越、甚至在物理上都“热”得发烫的计算机。更令人兴奋的是，这里遍布着Perk工作站，不仅实验室里有，甚至连Avi自己的办公室里都能配备一台，这在当时简直是闻所未闻的奢华配置。

卡内基梅隆的学术氛围也与众不同。这里的课程要求极少，Avi在整个研究生期间可能只修了四门课。学校更注重“应用研究”，几乎每个人都在从事着能带来实际影响、在三到五年甚至十年内就能看到成果的具象项目。这种务实的精神深深吸引了Avi。

寻找导师和项目时，Avi与Rick Rashid教授的结缘似乎是水到渠成。Rick曾是罗切斯特大学的毕业生，这层联系加上Avi对操作系统（OS）的浓厚兴趣，让他们自然而然地走到了一起。Rick的研究领域正是操作系统，他当时正致力于Perk系统上的Accent操作系统。然而，Avi并不想重复前人的工作，他渴望从零开始，做一些全新的东西。Accent虽然成熟，甚至已经通过Perk公司进行销售，但Avi想要的是一片未被开垦的处女地。

Rick教授似乎看出了Avi的雄心壮志。他向Avi透露了一个正在申请DARPA资助的新项目——构建并行计算系统。这在当时是一个几乎无人涉足的领域，虽然有些初步尝试，但远未成熟。Avi立刻被这个“白手起家”的机会点燃了热情，他决定投身其中，Rick也给予了他极大的支持。就这样，Avi的并行计算之旅正式启程。

当时的卡内基梅隆，除了并行计算，还有许多热门研究方向。RISC架构虽然更偏向硬件，但也是焦点之一。机器人学正处于萌芽阶段，虽然远不及今日的规模，但已显露锋芒。人工智能（AI）更是炙手可热，尽管当时的技术资源有限，人们尚未能真正实现其潜力，但研究者们正全力以赴。此外，计算机视觉、事务处理技术和数据库等领域也都有活跃的研究。不过，文件系统项目则稍晚才兴起。

Avi对并行计算的投入近乎“隧道视野”，他坚信他们是先行者，这个问题尚未解决，而他们将使其成为现实。在他看来，这并非一个难以逾越的障碍，无非是将一台计算机变成四台，只需协调好各项事务，而信号量等基本概念早已为人所知。他觉得这只是需要一番努力的“硬仗”。

DARPA的资助很快到位，数字设备公司（DEC）受命为项目打造计算机。他们将一台DEC VAX-11/780改造成了VAX-11/784，即将四台780通过共享内存互联。Avi对780情有独钟，现在能同时使用四台，并且可以为它从头编写操作系统，这简直是梦想成真。作为项目的一部分，他还得到了一台刚发布的MicroVAX，放在自己的办公室里，这让他拥有了整个学校里最先进的个人电脑。

他们的目标并非简单地并行化Unix，而是要从更基础的层面出发，构建一个适用于并行计算机的操作系统。这意味着要重新思考线程、调度、虚拟内存管理等核心概念。然而，在Rick的建议下，他们很快意识到，构建一个完全从零开始且实用的操作系统极其困难。为了利用Unix已有的丰富工具（如`grep`、`sed`等）并方便其他研究者使用他们的成果，他们采取了一种混合策略：构建一个全新的核心操作系统——Mach内核，然后在其上嫁接BSD Unix。这个整体，便是后来广为人知的Mach。

关于“Mach”这个名字的由来，也有一段趣闻。当时项目组还没有正式名称，匹兹堡多雨，Avi和Rick以及几位研究生经常去附近的匹兹堡大学（Pitt）吃午饭。他们一边走一边讨论着项目的名字，试图找出包含“多处理器”和“计算”等词的缩写，但都无果。有一次，他们走过一座桥，看到路边泥泞不堪，有人随口说了句：“看这些‘muck’（泥浆）！”接着又开玩笑说：“‘Muck’，这不就是个好名字吗？‘Multi-User Communicating Kernel’（多用户通信内核）！”午饭后，他们把这个玩笑讲给一位意大利裔的教授听，教授却把“muck”听成了“Mach”，并赞叹道：“Mach，好名字！”于是，这个名字便沿用了下来，与《星际迷航》并无关联。

微内核（Microkernel）的概念并非Mach首创，Accent操作系统和斯坦福大学的V内核项目都曾有过类似的设计。但Mach在此基础上进行了创新，它将内核功能最小化，只保留了对受保护资源的管理、处理器和内存的调度等核心功能。其他如文件系统、网络、设备驱动等，虽然在概念上位于微内核之外，但为了性能优化，它们通常会与内核协同工作。Mach在Accent专注于消息传递和写时复制（copy-on-write）虚拟内存的基础上，进一步解决了多处理器系统中的调度和虚拟内存管理问题，并更正式地定义了内核外服务的概念。这些看似细微的改进，实则对操作系统领域产生了深远的影响。Mach 2.5版本便是一个混合微内核，部分功能仍在内核空间，而Mach 3则尝试将更多功能移至用户空间。

# Chapter 6: Mach的内核演进与团队壮大

在卡内基梅隆大学的实验室里，Avi Tavanian和他的团队正面临着一项艰巨的技术挑战：如何为多处理器系统设计一个既能支持“写时复制”（copy-on-write）概念，又能高效运行的虚拟内存系统？这远比单处理器系统复杂得多。同时，他们还在探索将服务从内核中分离出来，即使出于优化考虑，这些服务最终可能仍会驻留在内核内部。这些看似微小的改进，实则蕴含着深刻的变革。

Mach操作系统的发展并非一蹴而就。早期的Mach 2.5版本，为了追求极致的性能，采用了混合微内核架构，部分功能仍保留在内核空间，而非全部移至用户空间。然而，Mach 3.0则大胆尝试将所有服务都推向用户空间，旨在实现一个纯粹的微内核。Avi回忆道，Mach 3.0的努力更多是一项研究性探索，甚至是在他离开卡内基梅隆大学后，由OSF（开放软件基金会）部分完成的。他怀疑这个纯微内核的代码库是否真正进入了任何商业产品。事实证明，出于对性能的考量，即使是今天，像苹果和FreeBSD这样的主要操作系统，其内核设计也更倾向于Avi团队早期开发的混合或分区式单体内核模型，而非纯粹的微内核结构。纯微内核更多地证明了一种可能性，而非实际应用的首选。

Mach项目的启动，源于Avi对新事物的渴望，以及Rick Rashid教授基于潜在资助的建议。作为项目的首位成员，Avi肩负起了开创性的重任。Rick教授作为他的导师，初期更多地投入到Accent项目中，但随着其他学生的陆续加入，Mach团队逐渐壮大。Avi在完成学业的同时，也投入了大量精力进行前期调研，以确保项目能获得资助，并与DEC公司合作获取硬件，甚至在VAX 784集群建成之前，就在一台MicroVAX上进行了大量的原型开发。

Avi自然而然地成为了代码库的掌控者。虽然他本人对此没有记忆，但有人曾形容他是一位“仁慈的独裁者”，对代码质量有着近乎严苛的要求。几年后，Mach项目规模迅速扩大，团队不仅有学生，还开始聘请研究人员。很快，团队成员就达到了十余人，并在系内开始部署，供部门内部人员使用。项目的资金主要来自DARPA（美国国防高级研究计划局）的IPO部门，虽然Avi不记得具体年份，但资助来得相对较早，为项目的快速发展提供了坚实保障。

Mach之所以能迅速在计算机界声名鹊起，被誉为“计算的未来”，有两大关键原因。首先，它采用了BSD Unix作为接口，这使得学术界的用户能够轻松上手，因为Mach提供了一个“更好”的BSD Unix——它剔除了BSD中一些不受欢迎的部分，并加入了用户喜爱的新功能，这一设计理念甚至影响了今天的FreeBSD。其次，也是最重要的一点，Mach团队不仅撰写了高质量的研究论文，积极参加Usenix等行业会议进行宣讲，更在论文中明确指出：“顺便说一句，你可以在这里获取一份代码。”这种将研究成果与实际代码同步发布的做法，在当时的研究界是独树一帜的。卡内基梅隆大学的文化强调应用性，他们认为如果研究成果不能被他人实际使用，那便是失败。

Mach的深远影响，甚至超越了技术本身，催生了意想不到的合作关系。在一次Usenix会议上，史蒂夫·乔布斯派出的NeXT公司员工被Mach深深吸引。他们不仅喜欢所听到的内容，还亲自体验了Mach系统。随后，NeXT公司主动联系Avi团队，希望将Mach整合到NeXT电脑中。这发生在1986-87年间，NeXT公司刚成立不久。这次合作促成了Avi与史蒂夫·乔布斯之间深厚的友谊，并最终为苹果公司的发展奠定了基础，这几乎是一个非技术性的传奇故事。

除了NeXT/苹果，Mach的影响力还延伸到了OSF（开放软件基金会）和BSD社区。虽然Rick Rashid将他的研究哲学带到了微软，但Mach的架构和理念并未直接影响微软的操作系统。实践证明，纯微内核结构在性能上仍面临挑战，因此，像苹果这样的商业产品，至今仍采用Avi团队早期开发的混合或分区式单体内核模型。

Mach项目最初是为VAX 784多处理器集群量身定制的，但其发展轨迹很快超越了这一特定硬件。Avi在MicroVAX单处理器系统上的早期工作，为Mach的通用性奠定了基础。团队很快意识到BSD的不可移植性，于是将Mach打造成一个高度可移植的操作系统，使其能够运行在Encore（MIPS）、Sequent（Intel）、IBM RT（Power）以及HP（PA-RISC）等多种不同架构的系统上。Avi甚至在80年代中期就设想过将这种“微内核”应用于冰箱等嵌入式设备，思考其商业价值。Mach不仅解决了多处理器系统的复杂性，还应对了不同内存架构和缓存效率的挑战，成为一个既可移植又支持多处理器的通用操作系统。尽管许多迷你超级计算机制造商与Mach团队有合作项目，但他们通常会发布自己的操作系统，不过这些合作无疑极大地丰富了Mach的经验和技术积累。

Avi的博士论文，在Rick Rashid的建议下，没有选择宽泛的Mach项目本身，而是聚焦于Mach操作系统的虚拟内存系统，特别是其作为“首个可移植且并行的虚拟内存系统”的创新之处。他的论文在离开卡内基梅隆大学之前完成，并由Rick Rashid、Al Spector和传奇人物Dennis Ritchie共同组成的委员会进行答辩，这无疑是计算机科学领域的“黄金标准”。尽管个人电脑在80年代初期蓬勃发展，但Avi在研究生阶段的研究重心始终放在高性能计算领域，而非个人电脑操作系统，这或许是因为当时的硬件尚未完全满足他们对低端系统功能的需求。

# Chapter 7: 从个人电脑到乔布斯的邀约：Mach的商业转折

在卡内基梅隆大学的学术象牙塔中，Avi Tavanian的生活并非只有深奥的操作系统研究。他回忆起自己的个人计算设备，一台MicroVAX，虽然不像Macintosh那样低端，但已是个人工作站的雏形。他坦言，当时团队并未将重心放在更低端的个人电脑上，或许是硬件尚未成熟，无法承载他们宏大的设想。

Avi还分享了与DARPA互动的经历。虽然他从未受邀参加在Snowbird举行的、旨在建立研究社区的年度DARPA会议（Rick Rashid或许参加过），但他确实定期前往华盛顿，向DARPA汇报Mach项目的进展。

谈及个人电脑选择，Avi解释了为何他选择了Macintosh而非IBM兼容机。他认为Macintosh继承了施乐Alto的“3M机器”（百万像素、百万指令、兆字节内存）理念，而PC则不然。加上学生折扣，Macintosh成为了他负担得起的理想选择。

除了科研，Avi还有一项“副业”——将游戏《Missile Command》和《Defender》移植到Macintosh上。这纯粹是出于兴趣，Macintosh的计算能力相对Alto而言已相当可观，但Alto的微代码编程能力仍是Macintosh难以企及的。移植过程相对顺利，但一个棘手的问题是游戏中的音效和音乐。当时的Macintosh，一旦开启声音处理器，就会消耗超过50%的CPU周期，导致游戏运行卡顿。为了解决这个问题，Avi不得不绕过Macintosh自带的声音驱动，编写了自己的驱动程序，才让游戏流畅运行。

这些游戏最初有商业化的打算。Avi曾与洛杉矶一家软件发行商签订合同，甚至应要求加入了光盘坏扇区复制保护。然而，这家公司似乎在游戏发行前就倒闭了，于是Avi将游戏作为免费软件发布，并附上了一段信息：“如果你喜欢，请寄支票。”零星的几张5美元、10美元支票寄来，几乎让他收回了购买Macintosh的成本，但这份经历并未将他引向共享软件的编程生涯。

随着研究生生涯进入后半段，Avi开始思考毕业后的去向。他当时在卡内基梅隆大学过得非常愉快，作为操作系统的核心开发者，他掌控着代码库，享受着被同事咨询和依赖的成就感。Mach项目备受关注，许多公司都对他们的技术感兴趣。他甚至差点陷入了卡内基梅隆大学研究生常见的“毕业拖延症”，当时已是1987年（或1986年），他已是第四年研究生。

一个转折点发生在Avi和Rick Rashid前往伯克利参加Unix会议期间。他们意外得知史蒂夫·乔布斯想与他们会面。这是Avi第一次来到旧金山，他和Rick住在一个机场附近不太好的酒店。晚餐约在NeXT位于Deer Creek Road的办公室。乔布斯兴奋地走下来，握手时对Avi说：“我们以前见过面。”Avi否认，但乔布斯坚持，这让Avi感到有些困惑。

晚餐时，NeXT团队透露了一个惊人的消息：他们想在自己的电脑上使用Mach操作系统！Avi简直不敢相信。乔布斯离开后，他们继续与NeXT的其他人用餐，然后前往伯克利参加会议。那一刻，Avi心中只有一个念头：“天哪，我得赶紧毕业了，这些家伙想用我们的东西，他们可能会遇到困难，我得去帮他们。”他意识到，企业界需要他了。

于是，Avi开始整理思绪，加速完成博士论文，并在Rick、Al和Dennis的评审下顺利通过了论文答辩。与此同时，他也开始了求职面试。最终，他选择了NeXT。

在求职过程中，Avi也面试了微软和Sun公司。Sun公司显得有些混乱，虽然他认识James Gosling等一些人，但他们似乎没有明确的职位规划。微软则非常组织有序，也想聘用他。最终，Avi需要在微软和NeXT之间做出选择。他甚至推测，如果他当时去了微软，Windows NT可能就不会以现在的形式存在，因为在他拒绝后，微软才聘请了David Cutler。

Avi回忆起在微软的面试经历：与比尔·盖茨的交流非常愉快，盖茨对技术充满热情，面试更像是一场关于设计决策的深入探讨，这让他耳目一新。与史蒂夫·鲍尔默的谈话则更偏向销售，鲍尔默似乎并不了解他的具体工作，只是知道其他人认为应该聘用他。他还与内森·梅尔沃德（Nathan Myhrvold）以及DOS和OS/2团队的人进行了交流。他发现微软内部存在一些“派系斗争”，并且不确定他们是否真正致力于OS/2，也不清楚他去了之后是修复OS/2还是开发新系统，这种不确定性让他感到犹豫。

最终，Avi选择NeXT有几个关键原因：首先，这是一个将他亲手开发的技术推向成功的绝佳机会，这在微软并不明确。其次，这是大公司（微软）与初创公司（NeXT）之间的选择，当时微软市值一两亿美元，未来增长空间未知，而NeXT作为初创公司，无疑拥有巨大的成长潜力。最后，虽然他很欣赏比尔·盖茨和史蒂夫·乔布斯，但乔布斯不仅对技术充满热情，还深谙如何将产品推向市场，这更吸引Avi。最重要的是，NeXT明确表示要使用他的技术，这对他来说意义重大。

此外，乔布斯亲自参与了Avi的招聘过程，多次打电话跟进，甚至在Avi犹豫不决时，乔布斯会亲自提出新的条件。这在规模庞大的微软是比尔·盖茨无法做到的。虽然Avi没有像传说中那样与乔布斯进行“招聘散步”，但乔布斯这种个人化的招募方式，无疑给Avi留下了深刻印象，也促成了他最终的决定。

# Chapter 8: 乔布斯的魅力与NeXT的诞生：光学驱动器之战

在职业选择的十字路口，Avi Tavanian面临着微软、Sun和NeXT的橄榄枝。与比尔·盖茨无法亲自出面提供个性化待遇不同，史蒂夫·乔布斯展现了截然不同的魅力。他不仅会亲自跟进，甚至会提出“让我给你这个”的诱人条件。虽然Avi没有亲身经历乔布斯传奇的“招聘散步”，但乔布斯独特的亲和力却给他留下了深刻印象。一次在卡内基梅隆大学的访问中，乔布斯带着团队请Avi等研究生共进晚餐。席间，乔布斯对Avi格外友好，开着玩笑，并在晚餐结束时指着Avi说：“把账单寄给那家伙！”这种不拘一格的“接地气”方式，让Avi感受到了乔布斯对他的重视与认可。

Avi加入NeXT时，公司仍在迪尔克里克（Deer Creek）的旧址。直到一年多以后，他们才搬到红木城。1988年10月，NeXT在迪尔克里克成功发布了首款产品，那是一场载入史册的发布会。关于这场发布会，电影《乔布斯》中的描述并非完全真实，尽管Avi曾试图向编剧亚伦·索尔金解释真相，但显然未被采纳。

Avi对发布会前夕的紧张气氛记忆犹新。就在发布会前两三天，团队正为光学驱动器的问题焦头烂额。作为首席操作系统科学家——一个为吸引他加入而特设的“花哨”头衔，Avi主要负责操作系统的核心部分，而非光学驱动器。然而，当时负责光学驱动器的工程师约翰·西蒙斯（John Seammons）虽然才华横溢，却在解决驱动器不稳定的问题上陷入困境，夜以继日地工作。

眼看发布会迫在眉睫，Avi决定亲自上阵，与约翰并肩作战。他以全新的视角审视问题，很快意识到需要一套可靠的测试机制。他迅速编写了一个简单的Unix级别测试程序，以略带随机的方式读写文件。结果，测试程序立即崩溃。通过加入日志记录，他们很快定位并修复了错误。然而，Avi并未止步于此，他深知代码的健壮性需要更严苛的考验。他和约翰不断迭代测试程序，甚至编写了一个向操作系统发出完全随机文件系统指令的程序——这种极端测试方式，任何正常程序都不会如此操作，目的就是为了找出隐藏的缺陷。他们连续工作了近48小时，最终让系统在各种“垃圾”输入下都能稳定运行。Avi回忆道，那段经历虽然艰苦，但并非压力重重，反而充满了解决难题的巨大满足感，就像在虚拟内存系统中寻找那些难以捉摸的错误一样。

从这次经历中，Avi学到了宝贵的一课：工程师们总以为自己能写出完美的代码，但真正检验代码的方法是“向它扔垃圾”，看它如何应对意料之外的输入。发布会当天，Avi坐在观众席中，亲眼见证了所有演示的完美运行。至于坊间流传的“中场休息时机器崩溃并重启”的传闻，Avi表示有可能，但他不记得了，并提到NeXT一直都有热备份系统以应对突发状况。

从学术界到NeXT的转变，对Avi而言，既有熟悉也有不同。他依然像在卡内基梅隆时一样，全身心投入工作，努力让一切运转。但不同的是，NeXT是一个完整的公司，有硬件团队、销售、市场、人力资源等部门，不再是纯粹的研究项目。这里有明确的截止日期，产品是要面向市场销售的，这带来了一种前所未有的“狂热”氛围。为了确保产品能在发布会上完美呈现，团队常常24小时不间断工作。虽然没有像《华尔街日报》报道中引述的公关人员所说的“用裹尸袋把他们抬出去”那么夸张，但Avi和许多同事确实过着“黑客式”的生活：工作到深夜，回家小睡片刻，凌晨三点去Denny's吃点东西，然后继续工作，直到清晨才回家补觉。那时的Avi还是单身，住在山景城的一个小公寓里，他热爱这种纯粹的“黑客式”生活。

Avi最初的职责是确保卡内基梅隆大学开发的Mach核心操作系统能顺利移植到NeXT电脑上。由于大部分代码都出自他手，他在团队中备受尊敬。大约一年后，他接管了整个操作系统团队，最终晋升为软件副总裁，负责包括AppKit、Interface Builder和NeXTSTEP层在内的更高层级软件栈。NeXT电脑采用了摩托罗拉68030处理器，虽然Avi曾是Mac程序员，熟悉68k指令集，但从未在68k上进行过操作系统级别的开发，Macintosh甚至没有虚拟内存，因此NeXT的工作对他而言是全新的挑战。

尽管史蒂夫·乔布斯在Macintosh时代就曾带领团队经历过类似的开发过程，NeXT公司内部也保留了一些Mac文化（例如非工程师员工普遍使用Mac进行桌面出版等工作），但Avi当时对Mac文化了解不多，无法确切判断其影响程度。对于外界对NeXT的狂热关注，Avi表示自己并未受到太多影响，因为他完全沉浸在工作中。他更像一个纯粹的工程师，专注于“让技术运转起来”，而非宏大的愿景。他回忆起第一次让音频在NeXT上工作时的兴奋：“这太酷了！”他认为，只要把手头的任务做好，不断突破技术极限，那些宏大的愿景自然会实现。

然而，Avi并非只专注于技术细节。由于公司规模小，加上他与乔布斯及管理团队建立了良好的关系，他很早就获得了参与公司战略讨论的机会，甚至在成为副总裁之前就已是执行团队的一员，这在当时是相当罕见的。在那些早期岁月里，他更多的是以学习者的姿态，从那些经验丰富的同事那里汲取知识，为NeXT的未来发展贡献自己的力量。

# Chapter 9: 从工程师到核心：NeXT的早期岁月与关键挑战

在NeXT的早期，Avi Tavanian虽然尚未晋升为副总裁，却早已是公司不可或缺的核心人物。他与史蒂夫·乔布斯及其他管理层建立了深厚的关系，这得益于他独特的工程师角色。他并非那种只专注于一小块代码的普通工程师，而是拥有极高的权限，甚至在没有副总裁头衔的情况下，就已是执行团队的一员。在那些初创的岁月里，他更多地是抱着学习的心态，从那些才华横溢的同事身上汲取知识。

Avi不仅在内部发挥着关键作用，也常常代表公司对外发声。他会在各种会议上担任演讲者，向外界介绍NeXT的技术。尤其是在史蒂夫·乔布斯精心培育的高等教育社区中，Avi更是重要的联络人。当有顶尖的计算机科学系需要拜访时，他总是被委以重任。随着公司业务的多元化，销售团队也频繁邀请他与客户交流。

在NeXT的团队中，Avi结识了许多有趣的人，其中一位便是来自里德学院的物理学家理查德·克兰德尔（Richard Crandall）。Avi至今仍清晰记得，1988年4月他第一次来到帕洛阿尔托的NeXT办公室报到，那天晚上十点多，办公室里空无一人，只有理查德还在。两人一见如故，从此成为挚友。不幸的是，理查德已于几年前去世，Avi回忆起他时，仍充满怀念，称他为自己在NeXT最好的朋友之一。

理查德在NeXT扮演着一个独特的角色，他被称为“Karajin”，总能发现系统中的问题。Avi第一次见到他时，理查德就开玩笑说：“你是谁？你在这儿干什么？你应该知道，这里的一切都坏了！”理查德是一位教育大使，他会编写教育应用程序，并通过这些应用来“逼迫”工程师们确保底层系统完美运行。他作为物理学家，常常以非传统的方式使用软件，从而暴露出许多意想不到的bug。理查德也是NeXT首次产品发布会上的重要人物，他亲自演示了自己编写的一些应用程序，展现了NeXT的强大潜力。

1988年4月Avi加入NeXT，同年10月，NeXT电脑正式发布。当时，公司的市场策略非常明确：专注于教育领域。史蒂夫·乔布斯巧妙地为NeXT开辟了一个空间，避免与苹果、Sun和IBM等巨头直接竞争。尽管他们知道自己正在打造一台通用计算机，但教育市场始终是他们的首要目标。

NeXT的文化充满了使命感。团队坚信他们正在创造前所未有的“不可思议”的产品，并为此付出了巨大的努力。工作强度极高，压力也很大，因为他们要在短时间内完成大量创新。虽然团队中也有一些按部就班的员工，但像Avi这样全身心投入的工程师更多。尽管偶尔会有分歧，但最终大家都能团结一致，共同为目标奋斗。

在众多挑战中，光学驱动器无疑是最大的“拦路虎”。这是一个前所未有的技术，需要实现写入、擦除和每次写入后的验证。这在当时是闻所未闻的壮举，要让现有的操作系统高效地适应这种模式，绝非易事。外界对光学驱动器的性能充满疑虑，而内部工程师们也深感担忧。但作为工程师，他们的职责就是解决问题。他们努力优化写入操作，最终通过缓存等标准技巧来提升性能，并最终在产品中加入了硬盘，实现了混合存储方案。NeXT电脑最终确实搭载了光学驱动器。

关于开发语言，Objective-C的选择是在Avi加入NeXT之前就已确定的。当时，团队渴望采用面向对象编程，但选择有限。Smalltalk虽然是纯粹的面向对象语言，但效率低下，难以用于实际产品；C++则更多是语法糖，并非真正的面向对象。因此，Objective-C成为了当时唯一真正可行的面向对象编程语言，至今仍被iOS开发广泛使用。屏幕显示语言则采用了Display PostScript，这在当时也是一项具有深远影响的创新，其模型至今仍以PDF的形式延续。

虽然NeXT从未将C++作为操作系统本身的开发语言，但为了满足部分客户的需求，他们曾开发了一个名为Objective C++的混合版本，允许其与Objective-C共存，但并未成为主流。NeXT还与理查德·斯托曼（Richard Stallman）合作，因为他们使用了他的GCC编译器。Avi曾与斯托曼共进晚餐，形容他“非常聪明，非常规，但固执己见”。NeXT团队非常感谢斯托曼的贡献，并努力成为其开源工作的良好管理者，尽管Avi本人并未直接与斯托曼合作，但他协助促成了团队与斯托曼及其团队的紧密联系。

NeXT的另一个战略是其独特的混合式开源与专有模式。这并非完全预设，而是一种务实的策略。在某些领域，他们认为可以创造出独特的、具有巨大附加值的专有技术；而在另一些领域，如网络（TCP/IP），开放和互操作性则更为重要。这种模式使得NeXT能够充分利用开源社区的优势，同时保持自身的核心竞争力。后来，苹果的OS X也继承了这一理念，其代码中很大一部分都是开源的Unix核心。

NeXTSTEP的发布也经历了一个过程。第一批NeXT Cube出货时，搭载的是0.8版本（并非正式的1.0，但也不是测试版），随后是0.9，最终才发布了1.0版本。关于发布会上的音乐合成程序，Avi澄清道，他并未编写那个与小提琴手合奏的程序，他所编写的是第一个用于验证声音功能是否正常的测试程序。那个令人惊叹的演示是由DSP合成乐器完成的，他只是与编写者合作过。

回顾NeXTSTEP项目，除了光学驱动器这个巨大的“范式问题”外，主要的挑战还包括提供前所未有的开发者工具，这需要与开发者建立全新的合作模式，并推动他们的采纳。此外，作为一个新平台，NeXT无法独自开发所有应用程序，因此吸引第三方开发者构建应用也是一大难题。当然，硬件定价也是一个不容忽视的挑战。

# Chapter 10: NeXT的战略巨变与软件创新之路

在NeXT的早期，尽管光学驱动器这一巨大的技术障碍已被克服，但公司面临的挑战远不止于此。Avi回忆道，除了日常的工程难题，最大的困境在于如何在一个全新的领域——提供前所未有的开发者工具——中站稳脚跟。这意味着不仅要打造卓越的工具，更要吸引开发者采纳，并为NeXT平台构建应用程序。然而，高昂的硬件成本成为了一个巨大的市场壁垒，使得NeXT的电脑在价格上难以与主流竞争。

面对市场困境，NeXT的战略发生了重大转变，从最初聚焦教育市场转向了商业生产力领域。Avi清晰地记得，这一转变的关键事件是与Businessland公司签订了一份价值高达一亿美元的产品采购协议。这笔交易让整个团队为之振奋，甚至史蒂夫·乔布斯还带着Avi去参加了里根总统出席的庆祝活动，预示着NeXT即将迎来商业上的巨大成功。然而，命运弄人，Businessland不久后便宣告破产，这笔看似辉煌的交易最终化为泡影，给NeXT带来了沉重打击。

在市场竞争中，NeXT的主要对手并非PC厂商，而是工作站市场的巨头Sun公司。Avi回忆起NeXT曾制作过一个颇具挑衅意味的营销视频：两名程序员并排工作，一个使用NeXTSTEP，另一个使用Sun的开发工具，结果NeXT的程序员以压倒性优势击败了对手，充分展示了NeXTSTEP在开发效率上的卓越。这种直接的竞争策略，让NeXT在工作站领域占据了一席之地。

随着时间的推移，NeXT做出了一个更具颠覆性的决定：放弃自家的Motorola 68k硬件，转而将NeXTSTEP操作系统移植到Intel架构的PC上销售。Avi解释说，这并非为了使用Intel的硬件，而是为了利用PC厂商的规模效应和零利润率策略，以更低的成本将软件推向市场。得益于NeXTSTEP基于Mach微内核的便携性设计，这一移植过程相对顺利。NeXT的工程师们展现了惊人的效率，不仅成功移植到x86平台，还相继支持了PA-RISC、PowerPC、SPARC，甚至在从未上市的88k处理器原型机上也能运行。Avi自豪地说，只要有资金承诺，六个月内就能让系统在新架构上跑起来。

当然，这一从硬件到纯软件的战略转变在公司内部引发了激烈辩论。硬件部门自然不乐见，但大多数人则认为这是明智之举。史蒂夫·乔布斯最初可能也需要被说服，但当他意识到硬件业务的资本密集、高风险且回报甚微时，便成为了这一转变的坚定拥护者。Avi指出，通常只有当情况变得足够糟糕时，史蒂夫才会彻底转变观念。

在这一时期，NeXT还经历了人才流失的痛苦。Avi清晰地记得史蒂夫·乔布斯在电话中近乎哽咽地告诉他，公司联合创始人之一、他最亲密的伙伴之一Bud Tribble即将离职，转投竞争对手Sun。史蒂夫对此感到难以置信和受伤。Avi与Bud关系密切，他深知Bud是一位极其聪明、正直且乐于助人的同事，尽管他已不记得Bud离职的具体原因，但相信那一定是经过深思熟虑的。

Avi自己的职业生涯也在NeXT经历了快速成长。加入公司不到一年，他便从工程师晋升为管理者，这无疑是一场“实战演练”。尽管最初他带着“仁慈的独裁者”的工程师思维，但在小团队的紧密协作中，他逐渐学会了管理之道。在Avi的软件管理下，NeXTSTEP不断迭代，推出了3.0版本，并引入了分布式对象（Distributed Objects）和企业对象框架（Enterprise Objects Framework, EOF）等开创性功能，实现了跨网络与Windows系统通信的能力。他们甚至将NeXTSTEP的高层组件抽象为OpenStep，使其能在Solaris和Windows上运行，尽管与Sun的授权合作最终未能成功。

然而，Avi认为NeXT最革命性的产品是WebObjects。这款诞生于1996年左右的产品，是世界上第一个基于服务器的应用程序服务。Avi回忆道，一位工程师带着一个简单的想法找到他：一个服务器可以接收信息，处理后返回HTML。这个看似简单的演示，立刻让Avi看到了巨大的潜力。他授权团队投入资源开发，很快，WebObjects就展示了其改变世界的魔力——从实时更新的汽车配置器到与Sabre系统对接的机票预订，一切皆有可能。WebObjects的出现，让NeXT团队深切感受到万维网将带来的巨大变革。Avi坚信，如果NeXT没有被苹果收购，WebObjects必将成为一个庞大的业务，因为它在当时几乎没有竞争对手，拥有巨大的先发优势。WebObjects的成功也离不开EOF的支撑，EOF最初是作为数据库工具包（DBKit）而生，后来经过迭代，成为了访问数据库的强大框架，为WebObjects提供了坚实的数据层支持。

NeXT在这一时期所经历的战略调整、技术创新和市场挑战，不仅塑造了Avi的职业生涯，也为未来的计算世界留下了宝贵的遗产。

# Chapter 11: WebObjects的魅力、EOF的演进与NeXT的IPO插曲

在NeXT的创新历程中，WebObjects无疑是其璀璨的明珠之一。Avi回忆起第一次看到WebObjects演示时的震撼，那种“理所当然就该如此”的直觉，至今仍令人印象深刻。它仿佛打开了一扇通往未来应用开发的大门，让人们看到了构建服务器端应用的全新可能。

WebObjects与企业对象框架（Enterprise Objects Framework，简称EOF）的关系也颇为有趣。虽然WebObjects并非强制要求EOF，但两者却能相得益彰。EOF的诞生，源于NeXT对数据库访问重要性的深刻理解。最初，他们开发了一个名为DBKit（Database Kit）的工具包，旨在简化数据库操作。随着用户反馈的积累，NeXT不断迭代优化，最终将其重构为功能更强大、更受开发者欢迎的EOF。EOF使得WebObjects在处理数据源时如虎添翼，极大地提升了开发效率。

然而，NeXT的故事并非只有技术创新。在公司发展的关键时期，曾有过一次尝试性的IPO。Avi透露，虽然并未真正提交上市申请，但一份S1文件（美国证券交易委员会要求上市公司提交的注册声明）已经完成了95%，甚至他本人还向博物馆捐赠了一份原始副本。这份草案的日期大约是1996年11月，巧合的是，这正是NeXT与苹果公司开始洽谈收购事宜的同一时间。最终，苹果的介入，使得NeXT的IPO计划戛然而止，被一场更宏大的收购所取代。

至于Java在NeXT的地位，Avi坦言，当时NeXT并没有一个明确的Java战略。Java的引入更多是为了兼容性考量，而非核心发展方向。不过，值得一提的是，Blaine Garol，一位在NeXT工作的工程师，据称在离开NeXT之前就已经为WebObjects创建了Java桥接器，这预示着NeXT在技术融合方面的开放态度，尽管当时Java尚未成为其主导策略。

