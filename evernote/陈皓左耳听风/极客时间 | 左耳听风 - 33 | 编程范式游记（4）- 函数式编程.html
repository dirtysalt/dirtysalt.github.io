<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 9.5.14 (465167)"/><meta name="created" content="2018-10-16 13:19:06 +0000"/><meta name="source" content="web.clip7"/><meta name="source-application" content="WebClipper 7"/><meta name="source-url" content="https://time.geekbang.org/column/article/2711"/><meta name="updated" content="2018-10-16 13:21:41 +0000"/><title>极客时间 | 左耳听风 - 33 | 编程范式游记（4）- 函数式编程</title></head><body><div style="font-size: 16px; min-width: 100%;"><div style="font-size: inherit; vertical-align: baseline;"><div style="vertical-align: baseline; font-size: 16px; text-align: left;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="position: relative; vertical-align: baseline; font-size: inherit; border: 0px; padding: 0px 2em; margin: 0px auto; z-index: 200; width: 36em;"><div style="margin: 0px 25px 0px -25px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; position: relative;"><div style="margin: 0px; padding: 4.5em 0px 9em; border: 0px; font-size: inherit; vertical-align: baseline; position: relative;"><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; position: relative;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="background-color: transparent; margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><h1 style="vertical-align: baseline; text-align: left; border: 0px; font-size: 35px; margin: 0px; padding: 0px;"/></div><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">从前三章内容中，我们了解到，虽然 C 语言简单灵活，能够让程序员在高级语言特性之上轻松进行底层上的微观控制，被誉为“高级语言中的汇编语言”，但其基于过程和底层的设计初衷又成了它的短板。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">在程序世界中，编程工作更多的是解决业务上的问题，而不是计算机的问题，我们需要更为贴近业务更为抽象的语言，如面向对象语言 C++ 和 Java 等。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">C++ 很大程度上解决了 C 语言中的各种问题和不便，尤其是通过类、模板、虚函数和运行时识别等解决了 C 语言的泛型编程问题。然而，如何做更为抽象的泛型呢？答案就是函数式编程（Functional Programming）。</span></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">函数式编程</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">相对于计算机的历史而言，函数式编程其实是一个非常古老的概念。函数式编程的基础模型来源于 λ 演算，而 λ 演算并非设计于在计算机上执行。它是由 Alonzo Church 和 Stephen Cole Kleene 在 20 世纪 30 年代引入的一套用于研究函数定义、函数应用和递归的形式系统。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">如 Alonzo 所说，像 booleans、integers 或者其他的数据结构都可以被函数取代掉。</span></div><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="background-color: transparent; margin: 1em 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; text-align: center;"><img src="images/%E6%9E%81%E5%AE%A2-7fac133e887bb91f6619887e6a6dcfcd.png" height="997" width="1330"/><br/></div><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们来看一下函数式编程，它的理念就是借用于数学中的代数。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">f(x)=5x^2+4x+3</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">g(x)=2f(x)+5=10x^2+8x+11</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">h(x)=f(x)+g(x)=15x^2+12x+14</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">假设 f(x) 是一个函数，g(x) 是第二个函数，把 f(x) 这个函数套下来，并展开。然后还可以定义一个由两个一元函数组合成的二元函数。还可以做递归，下面这个函数定义就是斐波那契数列。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">f(x)=f(x-1)+f(x-2)</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">对于函数式编程来说，其只关心，</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">定义输入数据和输出数据相关的关系，数学表达式里面其实是在做一种映射（mapping），输入的数据和输出的数据关系是什么样的，是用函数来定义的</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">函数式编程有以下特点。</span></div><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 250, 165);-evernote-highlight:true;">特征</span></div><ul style="padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">stateless</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">：函数不维护任何状态。函数式编程的核心精神是 stateless，简而言之就是它不能存在状态，你给我数据我处理完扔出来，里面的数据是不变的。</span></span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">immutable</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">：输入数据是不能动的，动了输入数据就有危险，所以要返回新的数据集。</span></span></div></li></ul><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 250, 165);-evernote-highlight:true;">优势</span></div><ul style="padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">没有状态就没有伤害。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">并行执行无伤害。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">Copy-Paste 重构代码无伤害。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">函数的执行没有顺序上的问题。</span></div></li></ul><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="background-color: transparent; margin: 1em 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; text-align: center;"><img src="images/%E6%9E%81%E5%AE%A2-134bd812c06ca16d8f29bc40174055a2.png" height="795" width="1020"/><br/></div><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">函数式编程还带来了以下一些好处。</span></div><ul style="padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">惰性求值</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。这需要编译器的支持。表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值。也就是说，语句如 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x:=expression;</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">  (把一个表达式的结果赋值给一个变量) 显式地调用这个表达式被计算并把结果放置到 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 中，但是先不管实际在 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 中的是什么，直到通过后面的表达式中到 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 的引用而有了对它的值的需求的时候，而后面表达式自身的求值也可以被延迟，最终为了生成让外界看到的某个符号而计算这个快速增长的依赖树。</span></span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">确定性</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。所谓确定性，就是像在数学中那样，</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">f(x) = y</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 这个函数无论在什么场景下，都会得到同样的结果，这个我们称之为函数的确定性。而不是像程序中的很多函数那样，同一个参数，却会在不同的场景下计算出不同的结果。所谓不同的场景，就是我们的函数会根据运行中的状态信息的不同而发生变化。</span></span></div></li></ul><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">我们知道，因为状态，在并行执行和 copy-paste 时引发 bug 的概率是非常高的，所以没有状态就没有伤害，就像没有依赖就没有伤害一样，并行执行无伤害，copy 代码无伤害，因为没有状态，代码怎样拷都行。</span></div><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline; background-color: rgb(255, 250, 165);-evernote-highlight:true;">劣势</span></div><ul style="padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">数据复制比较严重。</span></div></li></ul><blockquote style="quotes: none; margin: 0px 0px 1.5em 2em; border-width: 0px 0px 0px 5px; font-size: inherit; vertical-align: baseline; padding: 0px 0px 0px 1em; border-left-style: solid;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-style: italic; background-color: rgb(255, 250, 165);-evernote-highlight:true;"
/><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-style: italic; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">注</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-style: italic;">：有一些人可能会觉得这会对性能造成影响。其实，这个劣势并不见得会导致性能不好。因为没有状态，所以代码在并行上根本不需要锁（不需要对状态修改的锁），所以可以拼命地并发，反而可以让性能很不错。比如：Erlang 就是其中的代表。</span></span></div></blockquote><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">对于纯函数式（也就是完全没有状态的函数）的编程来说，各个语言支持的程度如下。</span></div><ul style="padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">完全纯函数式 Haskell</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">容易写纯函数 F#, Ocaml, Clojure, Scala</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">纯函数需要花点精力 C#, Java, JavaScript</span></div></li></ul><div style="margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; background-color: rgb(255, 250, 165);-evernote-highlight:true;">完全纯函数的语言，很容易写成函数，纯函数需要花精力。只要所谓的纯函数的问题，传进来的数据不改，改完的东西复制一份拷出去，然后没有状态。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">但是很多人并不习惯函数式编程，因为函数式编程和过程式编程的思维方式完全不一样。过程式编程是在把具体的流程描述出来，所以可以不假思索，而函数式编程的抽象度更大，在实现方式上，函数套函数，函数返回函数，函数里定义函数……把人搞得很糊涂。</span></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">函数式编程用到的技术</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">下面是函数式编程用到的一些技术。</span></div><ul style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">first class function（头等函数）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ：这个技术可以让你的函数就像变量一样来使用。也就是说，你的函数可以像变量一样被创建、修改，并当成变量一样传递、返回，或是在函数中嵌套函数。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">tail recursion optimization（尾递归优化）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ： 我们知道递归的害处，那就是如果递归很深的话，stack 受不了，并会导致性能大幅度下降。因此，我们使用尾递归优化技术——每次递归时都会重用 stack，这样能够提升性能。当然，这需要语言或编译器的支持。Python 就不支持。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">map &amp; reduce</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ：这个技术不用多说了，函数式编程最常见的技术就是对一个集合做 Map 和 Reduce 操作。这比起过程式的语言来说，在代码上要更容易阅读。（传统过程式的语言需要使用 for/while 循环，然后在各种变量中把数据倒过来倒过去的）这个很像 C++ STL 中 foreach、find_if、count_if 等函数的玩法。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">pipeline（管道）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">：这个技术的意思是，将函数实例成一个一个的 action，然后将一组 action 放到一个数组或是列表中，再把数据传给这个 action list，数据就像一个 pipeline 一样顺序地被各个函数所操作，最终得到我们想要的结果。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">recursing（递归）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ：递归最大的好处就简化代码，它可以把一个复杂的问题用很简单的代码描述出来。注意：递归的精髓是描述问题，而这正是函数式编程的精髓。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">currying（柯里化）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ：将一个函数的多个参数分解成多个函数， 然后将函数多层封装起来，每层函数都返回一个函数去接收下一个参数，这可以简化函数的多个参数。在 C++ 中，这很像 STL 中的 bind1st 或是 bind2nd。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">higher order function（高阶函数）</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">：所谓高阶函数就是函数当参数，把传入的函数做一个封装，然后返回这个封装函数。现象上就是函数传进传出，就像面向对象对象满天飞一样。这个技术用来做 Decorator 很不错。</span></div></li></ul><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面这些技术太抽象了，我们还是从一个最简单的例子开始。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">// 非函数式，不是 pure funciton，有状态</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">int cnt;</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">void increment(){</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    cnt++;</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">}</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">这里有个全局变量，调这个全局函数变量 ++，这里面是有状态的，这个状态在外部。所以，如果是多线程的话，这里面的代码是不安全的。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">如果写成纯函数，应该是下面这个样子。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">// 函数式，pure function， 无状态</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">int increment(int cnt){</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return cnt+1;</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">}</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">这个是你传给我什么，我就返回这个值的 +1 值，你会发现，代码随便拷，而且与线程无关，代码在并行时候不用锁，因为是复制了原有的数据，并返回了新的数据。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们再来看另一个例子：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def inc(x):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    def incx(y):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        return x+y</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return incx</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">inc2 = inc(2)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">inc5 = inc(5)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">print inc2(5) # 输出 7</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">print inc5(5) # 输出 10</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面这段 Python 的代码，开始有点复杂了。我们可以看到上面那个例子</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">inc()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">函数返回了另一个函数</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">incx()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">，于是可以用</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">inc()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">函数来构造各种版本的 inc 函数，比如：</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">inc2()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">和</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">inc5()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。这个技术其实就是上面所说的 currying 技术。从这个技术上，你可能体会到函数式编程的理念。</span></div><ul style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">把函数当成变量来用，关注描述问题而不是怎么实现，这样可以让代码更易读</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">因为函数返回里面的这个函数，所以函数关注的是表达式，关注的是描述这个问题，而不是怎么实现这个事情</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div></li></ul><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">Lisp 语言介绍</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">要说函数式语言，不可避免地要说一下 Lisp。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">下面，我们再来看看 Scheme 语言（Lisp 的一个方言）的函数式玩法。在 Scheme 里，所有的操作都是函数，包括加减乘除这样的东西。所以，一个表达式是这样的形式—— </span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-style: italic; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">（函数名 参数 1 参数 1）</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define (plus x y)  (+ x y))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define (times x y) (* x y))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define (square x)  (times x x))</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面三个函数：</span></div><ul style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">用内置的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">+</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数定义了一个新的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">plus</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">用内置的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">*</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数定义了一个新的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">times</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">用之前的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">times</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数定义了一个 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">square</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数。</span></div></li></ul><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">下面这个函数定义了： f(x) = 5 * x^2 +10</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define (f1 x) ;;; f(x) = 5 * x^2 + 10</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    (plus 10 (times 5 (square x))))</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">也可以这样定义——使用 lambda 匿名函数。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define f2</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    (lambda (x)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        (define plus</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            (lambda (a b) (+ a b)))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        (define times</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            (lambda (a b) (* a b)))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        (plus 10 (times 5 (times x x)))))</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">在上面的这个代码里，我们使用 lambda 来定义函数 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">f2</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> ，然后也同样用 lambda 定义了两个函数—— </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">plus</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 和 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">times</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。 最后，由 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">(plus 10 (times 5 (times x x)))</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 定义了 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">f2</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们再来看一个阶乘的示例：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">;;; recursion</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define factoral (lambda (x)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    (if (&lt;= x 1) 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        (* x (factoral (- x 1))))))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(newline)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(display(factoral 6))</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">下面是另一个版本的，使用了尾递归。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">;;; another version of recursion</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(define (factoral_x n)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    (define (iter product counter)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        (if (&lt; counter n)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            product</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            (iter (* counter product) (+ counter 1))))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    (iter 1 1))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(newline)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">(display(factoral_x 5))</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">函数式编程的思维方式</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">前面提到过多次，函数式编程关注的是：describe what to do, rather than how to do it。于是，我们把以前的过程式编程范式叫做 Imperative Programming – 指令式编程，而把函数式编程范式叫做 Declarative Programming – 声明式编程。</span></div><h2 style="background-color: transparent; vertical-align: baseline; margin: 35px 0px 15px; padding: 0px; border: 0px; text-align: left; font-size: 30px;"><span style="font-size: 30px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: bold;">传统方式的写法</span></h2><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">下面我们看一下相关的示例。比如，我们有 3 辆车比赛，简单起见，我们分别给这 3 辆车有 70% 的概率可以往前走一步，一共有 5 次机会，然后打出每一次这 3 辆车的前行状态。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">对于 Imperative Programming 来说，代码如下（Python）：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">from random import random</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">time = 5</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">car_positions = [1, 1, 1]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">while time:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    # decrease time</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    time -= 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print ''</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for i in range(len(car_positions)):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        # move car</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        if random() &gt; 0.3:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            car_positions[i] += 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        # draw car</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        print '-' * car_positions[i]</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们可以把这两重循环变成一些函数模块，这样有利于更容易地阅读代码：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">from random import random</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def move_cars():</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for i, _ in enumerate(car_positions):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        if random() &gt; 0.3:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            car_positions[i] += 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def draw_car(car_position):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print '-' * car_position</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def run_step_of_race():</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    global time</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    time -= 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    move_cars()</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def draw():</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print ''</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for car_position in car_positions:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        draw_car(car_position)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">time = 5</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">car_positions = [1, 1, 1]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">while time:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    run_step_of_race()</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    draw()</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面的代码，从主循环开始，我们可以很清楚地看到程序的主干，因为我们把程序的逻辑分成了几个函数。这样一来，代码逻辑就会变成几个小碎片，于是我们读代码时要考虑的上下文就少了很多，阅读代码也会更容易。不像第一个示例，如果没有注释和说明，你还是需要花些时间理解一下。而将代码逻辑封装成了函数后，我们就相当于给每个相对独立的程序逻辑取了个名字，于是代码成了自解释的。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">但是，你会发现，封装成函数后，这些函数都会依赖于共享的变量来同步其状态。于是，在读代码的过程中，每当我们进入到函数里，读到访问了一个外部的变量时，我们马上要去查看这个变量的上下文，然后还要在大脑里推演这个变量的状态， 才能知道程序的真正逻辑。也就是说，这些函数间必需知道其它函数是怎么修改它们之间的共享变量的，所以，这些函数是有状态的。</span></div><h2 style="background-color: transparent; vertical-align: baseline; margin: 35px 0px 15px; padding: 0px; border: 0px; text-align: left; font-size: 30px;"><span style="font-size: 30px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: bold;">函数式的写法</span></h2><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们知道，有状态并不是一件很好的事情，无论是对代码重用，还是对代码的并行来说，都是有副作用的。因此，要想个方法把这些状态搞掉，于是出现了函数式编程的编程范式。下面，我们来看看函数式的方式应该怎么写？</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">from random import random</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def move_cars(car_positions):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return map(lambda x: x + 1 if random() &gt; 0.3 else x,</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">               car_positions)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def output_car(car_position):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return '-' * car_position</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def run_step_of_race(state):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return {'time': state['time'] - 1,</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            'car_positions': move_cars(state['car_positions'])}</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def draw(state):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print ''</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print '\n'.join(map(output_car, state['car_positions']))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def race(state):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    draw(state)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    if state['time']:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        race(run_step_of_race(state))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">race({'time': 5,</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">      'car_positions': [1, 1, 1]})</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面的代码依然把程序的逻辑分成了函数。不过这些函数都是函数式的，它们有三个特点：它们之间没有共享的变量；函数间通过参数和返回值来传递数据；在函数里没有临时变量。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们还可以看到，for 循环被递归取代了（见 race 函数）—— 递归是函数式编程中常用到的技术，正如前面所说的，递归的本质就是描述问题是什么。</span></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">函数式语言的三套件</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">函数式语言有三套件，</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">Map</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">、</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">Reduce</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 和 </span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">Filter</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。这在谈 C++ 的泛型编程时已经介绍过。下面我们来看一下 Python 语言中的一个示例。这个示例的需求是，我们想把一个字符串数组中的字符串都转成小写。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">用常规的面向过程的方式，代码如下所示：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 传统的非函数式</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">upname =['HAO', 'CHEN', 'COOLSHELL']</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">lowname =[] </span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">for i in range(len(upname)):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    lowname.append( upname[i].lower() )</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">如果写成函数式，用 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">map()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数，是下面这个样子。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 函数式</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def toUpper(item):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">      return item.upper()</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">upper_name = map(toUpper, ["hao", "chen", "coolshell"])</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">print upper_name</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 输出 ['HAO', 'CHEN', 'COOLSHELL']</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">顺便说一下，上面的例子是不是和我们 C++ 语言中的 STL 的</span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">transform()</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">函数有些像？</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">string s="hello";</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">transform(s.begin(), s.end(), back_inserter(out), ::toupper);</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">在上面 Python 的那个例子中可以看到，我们定义了一个函数 toUpper，这个函数没有改变传进来的值，只是把传进来的值做个简单的操作，然后返回。然后，我们把其用在 map 函数中，就可以很清楚地描述出我们想要干什么。而不会去理解一个在循环中怎么实现的代码，最终在读了很多循环的逻辑后才发现原来是这个或那个意思。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">如果你觉得上面的代码在传统的非函数式的方式下还是很容易读的，那么我们再来看一个计算数组平均值的代码：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 计算数组中正数的平均值</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">num =  [2, -5, 9, 7, -2, 5, 3, 1, 0, -3, 8]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">positive_num_cnt = 0</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">positive_num_sum = 0</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">for i in range(len(num)):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    if num[i] &gt; 0:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        positive_num_cnt += 1</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        positive_num_sum += num[i]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">if positive_num_cnt &gt; 0:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    average = positive_num_sum / positive_num_cnt</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">print average</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面的代码如果没有注释的话，你需要看一会儿才能明白，只是计算数组中正数的平均值。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们再来看看函数式下使用 filter/reduce 函数的玩法。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 计算数组中正数的平均值</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">positive_num = filter(lambda x: x&gt;0, num)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">average = reduce(lambda x,y: x+y, positive_num) / len( positive_num )</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">首先，我们使用 filter 函数把正数过滤出来（注意： </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">lambda x : x&gt;0</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 这个 lambda 表达式），保存在一个新的数组中 —— </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">positive_num</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。然后，我们使用 reduce 函数对数组 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">positive_num</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 求和后，再除以其个数，就得到正数的平均值了。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们可以看到， </span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">隐藏了数组遍历并过滤数组控制流程的 filter 和 reduce， 不仅让代码更为简洁，因为代码里只有业务逻辑了，而且让我们能更容易地理解代码</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div><ol style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: decimal outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">对 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">num</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 数组 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">filter</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 条件 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x &gt; 0</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 的数据。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">然后对 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">positive_num</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 进行  </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">x + y</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 操作的 reduce，即求和。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">……</span></div></li></ol><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">感觉代码更亲切了，不是吗？因为：</span></div><ul style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: disc outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">数据集、对数据的操作和返回值都放在了一起。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">没有了循环体，就可以少了些临时用来控制程序执行逻辑的变量，也少了把数据倒来倒去的控制逻辑。</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">代码变成了在描述你要干什么，而不是怎么干</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div></li></ul><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">当然，如果你是第一次见到 map/reduce/filter，那你可能还是会有点儿陌生和不解，这只是你不了解罢了。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">对于函数式编程的思路，下图是一个比较形象的例子，面包和蔬菜 map 到切碎的操作上，再把结果给 reduce 成汉堡。</span></div><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="background-color: transparent; margin: 1em 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; text-align: center;"><img src="images/%E6%9E%81%E5%AE%A2-cfbbd404c980f98040514371aceb8881.png" height="937" width="1250"/><br/></div><p style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-stretch: inherit; line-height: inherit; vertical-align: baseline;"/><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">在这个图中，</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">我们可以看到 map 和 reduce 不关心源输入数据，它们只是控制，并不是业务。控制是描述怎么干，而业务是描述要干什么</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">。</span></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">函数式的 pipeline 模式</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">pipeline（管道）借鉴于 Unix Shell 的管道操作——把若干个命令串起来，前面命令的输出成为后面命令的输入，如此完成一个流式计算。（注：管道绝对是一个伟大的发明，它的设计哲学就是 KISS – 让每个功能就做一件事，并把这件事做到极致，软件或程序的拼装会变得更为简单和直观。这个设计理念影响非常深远，包括今天的 Web Service、云计算，以及大数据的流式计算等。）</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">比如，我们如下的 shell 命令：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">ps auwwx | awk '{print $2}' | sort -n | xargs echo</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面的例子是要查看一个用户执行的进程列表，列出来以后，然后取第二列，第二列是它的进程 ID，排个序，再把它显示出来。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">抽象成函数式的样子，我们就可以反过来，一层套一层。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">xargs(  echo, sort(n, awk('print $2', ps(auwwx)))  )</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们也可以把函数放进数组里面，然后顺序执行一下。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">pids = for_each(result, [ps_auwwx, awk_p2, sort_n, xargs_echo])</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">多说一句，如果我们把这些函数比作微服务，那么管道这个事是在干什么呢？其实就是在做服务的编排。像 Unix 这些经典的技术上的实践或理论，往往是可以反映到分布式架构的，所以，一般来说，一个好的分布式架构师，通常都是对这些传统的微观上的经典技术有非常深刻的认识，因为这些东西在方法论上都是相通的。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">好了，还是让我们用一个简单的示例来看一下如何实现 pipeline。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们先来看一个程序，这个程序的 process() 有三个步骤：</span></div><ol style="background-color: transparent; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; margin: -1em 0px 1.5em 1.5em; list-style: decimal outside none;"><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">找出偶数；</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">乘以 3；</span></div></li><li style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; list-style-type: inherit; list-style-position: outside;"><div><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">转成字符串返回。</span></div></li></ol><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">传统的非函数式的实现如下：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def process(num):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    # filter out non-evens</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    if num % 2 != 0:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        return</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    num = num * 3</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    num = 'The Number: %s' % num</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return num</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">for num in nums:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print process(num)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 输出：</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 6</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 12</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 18</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 24</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 30</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">我们可以看到，输出的结果并不够完美，另外，代码阅读上如果没有注释，你也会比较晕。下面，我们来看看函数式的 pipeline（第一种方式）应该怎么写？</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">第一步，我们先把三个“子需求”写成函数：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def even_filter(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for num in nums:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        if num % 2 == 0:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            yield num</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def multiply_by_three(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for num in nums:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        yield num * 3</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def convert_to_string(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for num in nums:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        yield 'The Number: %s' % num</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">然后，我们再把这三个函数串起来：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">pipeline = convert_to_string(multiply_by_three(even_filter(nums)))</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">for num in pipeline:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print num</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># 输出：</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 6</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 12</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 18</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 24</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;"># The Number: 30</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面，我们动用了 Python 的关键字 yield，它是一个类似 return 的关键字，只是这个函数返回的是 Generator（生成器）。所谓生成器，指的是 yield 返回的是一个可迭代的对象，并没有真正的执行函数。也就是说，只有其返回的迭代对象被迭代时，yield 函数才会真正运行，运行到 yield 语句时就会停住，然后等下一次的迭代。（ yield 是个比较诡异的关键字）这就是 lazy evluation（懒惰加载）。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">好了，根据前面的原则——“</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">使用 Map &amp; Reduce，不要使用循环</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">”（还记得吗？使用循环会让我们只能使用顺序型的数据结构），那我们用比较纯朴的 Map &amp; Reduce 吧。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def even_filter(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return filter(lambda x: x%2==0, nums)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def multiply_by_three(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return map(lambda x: x*3, nums)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def convert_to_string(nums):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return map(lambda x: 'The Number: %s' % x,  nums)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">pipeline = convert_to_string(</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">               multiply_by_three(</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">                   even_filter(nums)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">               )</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            )</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">for num in pipeline:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print num</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">上面的代码是不是更容易读了，但需要嵌套使用函数，这个有点儿不爽，如果我们能像下面这个样子就好了（第二种方式）。</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">pipeline_func(nums, [even_filter,</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">                     multiply_by_three,</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">                     convert_to_string])</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">可以看到，其实，就是对一堆函数做一个 reduce， 于是，pipeline 函数可以实现成下面这样：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def pipeline_func(data, fns):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return reduce(lambda a, x: x(a),   fns,   data)</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">当然，使用 Python 的 </span><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">force</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;"> 函数以及 decorator 模式可以把上面的代码写得更像管道：</span></div><div style="background-color: rgb(243, 242, 238); margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; width: auto; font-size: 0.875em;"><div><code style="margin: 0px; padding: 0px; border: 0px; vertical-align: baseline; font-size: 1.15em;"><div><br/></div><table style="padding: 0px; border-spacing: 0px; border-collapse: collapse; margin: 0px; border: 0px; vertical-align: baseline; font-size: 1em;"><colgroup><col/><col/></colgroup><tbody style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">class Pipe(object):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    def __init__(self, func):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        self.func = func</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    def __ror__(self, other):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        def generator():</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">            for obj in other:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">                if obj is not None:</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">                    yield self.func(obj)</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">        return generator()</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">@Pipe</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def even_filter(num):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return num if num % 2 == 0 else None</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">@Pipe</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def multiply_by_three(num):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return num*3</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">@Pipe</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def convert_to_string(num):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return 'The Number: %s' % num</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">@Pipe</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def echo(item):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    print item</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    return item</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">def force(sqs):</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">    for item in sqs: pass</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span></div></td></tr><tr style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><td style="margin:0px;border:0px;font:inherit;padding:0.25em 0.25em 0.25em 0.4em;vertical-align:top;"/><td style="margin: 0px; border: 0px; font-size: inherit; padding: 0.25em 0.25em 0.25em 0.4em; vertical-align: top;"><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 1em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">force(nums | even_filter | multiply_by_three | convert_to_string | echo)</span></div></td></tr></tbody></table><div><br/></div></code></div><div style="margin: 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 0.875em; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.71429em;">复制代码</span></div></div><h1 style="background-color: transparent; margin: 0px 0px 20px; padding: 0px; border: 0px; text-align: left; vertical-align: baseline; font-size: 35px;"><span style="font-size: 35px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 35px; font-weight: normal;">小结</span></h1><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">相对于计算机发展史，函数式编程是个非常古老的概念，它的核心思想是将运算过程尽量写成一系列嵌套的函数调用，关注的是做什么而不是怎么做，因而被称为声明式编程。以 Stateless（无状态）和 Immutable（不可变）为主要特点，代码简洁，易于理解，能便于进行并行执行，易于做代码重构，函数执行没有顺序上的问题，支持惰性求值，具有函数的确定性——无论在什么场景下都会得到同样的结果。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">本文结合递归、map 和 reduce，以及 pipeline 等技术，对比了非函数式编程和函数式编程在解决相同问题时的不同处理思路，让你对函数式编程范式有了清晰明确的认知。并在文末引入了 decorator（修饰器），使得将普通函数管道化成为一件轻而易举的事情。此时你可能有疑问，decorator 到底是什么呢？怎样使用它呢？敬请关注下一章中的内容，来得到这些答案。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">了解了这么多函数式编程的知识，想请你深入思考一个问题：你是偏好在命令式编程语言中使用函数式编程风格呢，还是坚持使用函数式语言编程？原因是什么？欢迎在评论区留言和我一起探讨。</span></div><div style="background-color: transparent; margin: 0px 0px 1.5em; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline;"><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em;">以下是《编程范式游记》系列文章的目录，方便你了解这一系列内容的全貌。</span><span style="font-size: 16px; color: rgb(31, 9, 9); font-family: &quot;PT Serif&quot;; line-height: 1.5em; font-weight: bold; border: 0px; margin: 0px; padding: 0px; vertical-align: baseline;">这一系列文章中代码量很大，很难用音频体现出来，所以没有录制音频，还望谅解。</span></div><div style="background-color: transparent; margin: 1em 0px; padding: 0px; border: 0px; font-size: inherit; vertical-align: baseline; text-align: center;"><br/></div></div></div></div></div></div></div></div></div></div></div></div></div></div><div><br/></div></body></html>